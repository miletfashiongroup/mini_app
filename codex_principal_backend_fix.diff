

diff --git a/README.md b/README.md
index 417642e..3e6d347 100644
--- a/README.md
+++ b/README.md
@@ -1,138 +1,139 @@
-# BRACE — Telegram Mini App Commerce Monorepo
-
-BRACE is a production-ready monorepo for a Telegram Mini App that sells premium men's underwear. The repository bundles a FastAPI backend, a Vite + React frontend optimized for Telegram WebApp, infrastructure-as-code, CI/CD pipelines, and deployment playbooks so the project is deployable immediately.
-
-## Tech Stack
-- **Frontend**: Vite, React 18, TypeScript, TailwindCSS, TanStack Query, Zustand, Telegram WebApp SDK
-- **Backend**: FastAPI, async SQLAlchemy (psycopg 3 async driver), PostgreSQL, Redis-backed SlowAPI rate limiting, Alembic
-- **Infra**: Docker, docker-compose, Redis, nginx, GitHub Actions, Makefile helpers
-- **Security**: Telegram initData HMAC validation, DOMPurify, rate limiting, strict CORS
-
-## Repository Layout
-```
-packages/
-  backend/        # FastAPI service + Alembic + tests + Dockerfile
-  frontend/       # Vite React client + Tailwind + Dockerfile
-infra/
-  docker-compose.prod.yml
-  nginx/app.conf
-scripts/run-smoke.sh
-.github/workflows/ci.yml
-README.md, README-verify.md, DEPLOY.md, CHANGELOG.md, POSTMORTEM.md
-.env.example
-```
-
-## Key Features
-- Telegram initData verification middleware and `/api/verify-init` probe
-- Product, cart, order, and profile APIs with async PostgreSQL
-- 11 fully responsive Telegram-focused screens (home, catalog, product, size UX, profile, cart, etc.)
-- Dockerized services (backend, frontend, PostgreSQL) runnable via one compose command
-- GitHub Actions pipeline (lint → typecheck → test → build → deploy placeholder)
-- Comprehensive documentation: quickstart, verification, deployment, change-log, postmortem templates
-
-## Quickstart
+# BRACE — Telegram Mini App Commerce Monorepo
+
+BRACE is a production-ready monorepo for a Telegram Mini App that sells premium men's underwear. The repository bundles a FastAPI backend, a Vite + React frontend optimized for Telegram WebApp, infrastructure-as-code, CI/CD pipelines, and deployment playbooks so the project is deployable immediately.
+
+## Tech Stack
+- **Frontend**: Vite, React 18, TypeScript, TailwindCSS, TanStack Query, Zustand, Telegram WebApp SDK
+- **Backend**: FastAPI, async SQLAlchemy (psycopg 3 async driver), PostgreSQL, Redis-backed SlowAPI rate limiting, Alembic
+- **Infra**: Docker, docker-compose, Redis, nginx, GitHub Actions, Makefile helpers
+- **Security**: Telegram initData HMAC validation, DOMPurify, rate limiting, strict CORS
+
+## Repository Layout
+```
+packages/
+  backend/        # FastAPI service + Alembic + tests + Dockerfile
+  frontend/       # Vite React client + Tailwind + Dockerfile
+infra/
+  docker-compose.prod.yml
+  nginx/app.conf
+scripts/run-smoke.sh
+.github/workflows/ci.yml
+README.md, README-verify.md, DEPLOY.md, CHANGELOG.md, POSTMORTEM.md
+.env.example
+```
+
+## Key Features
+- Telegram initData verification middleware and `/api/verify-init` probe
+- Product, cart, order, and profile APIs with async PostgreSQL
+- 11 fully responsive Telegram-focused screens (home, catalog, product, size UX, profile, cart, etc.)
+- Dockerized services (backend, frontend, PostgreSQL) runnable via one compose command
+- GitHub Actions pipeline (lint → typecheck → test → build → deploy placeholder)
+- Comprehensive documentation: quickstart, verification, deployment, change-log, postmortem templates
+
+## Quickstart
 1. **Configure environment**
    ```bash
    cp .env.example .env
    ```
-   Populate `BRACE_TELEGRAM_BOT_TOKEN`, database credentials, and the `VITE_*` URLs that the frontend will embed.
-2. **Install toolchains**
-   ```bash
-   make backend-install frontend-install
-   ```
-3. **Provision local data stores**  
-   The backend & pytest suites expect PostgreSQL and Redis. Start the infra stack once:
-   ```bash
-   docker compose -f infra/docker-compose.prod.yml up -d db redis
-   ```
-4. **Backend development loop**
-   ```bash
-   cd packages/backend
-   poetry run alembic upgrade head
-   poetry run python -m brace_backend.services.seed
-   poetry run uvicorn brace_backend.main:app --reload
-   ```
-   The API is available at `http://localhost:8000/api/health`.
-5. **Frontend development loop**
-   ```bash
-   cd packages/frontend
-   npm run dev -- --host
-   ```
-   Visit `http://localhost:4173`; Vite proxies API calls to the backend URL from `.env`.
-6. **Full stack via Docker Compose**
-   ```bash
-   make docker-up          # build + run backend, frontend, postgres, redis
-   make docker-logs        # follow backend/frontend logs
-   make docker-down        # stop stack and wipe volumes
-   ```
-   Frontend is served at `http://localhost`, backend at `http://localhost:8000`.
+   Populate `BRACE_TELEGRAM_BOT_TOKEN`, database credentials, and the `VITE_*` URLs that the frontend will embed. The backend now auto-loads `.env` from the monorepo root even when commands are executed inside `packages/backend`; override the lookup via `BRACE_ENV_FILE=/path/to/.env` if you keep secrets elsewhere.  # PRINCIPAL-FIX
+2. **Install toolchains**
+   ```bash
+   make backend-install frontend-install
+   ```
+3. **Provision local data stores**  
+   The backend & pytest suites expect PostgreSQL and Redis. Start the infra stack once:
+   ```bash
+   docker compose -f infra/docker-compose.prod.yml up -d db redis
+   ```
+4. **Backend development loop**
+   ```bash
+   cd packages/backend
+   poetry run alembic upgrade head
+   poetry run python -m brace_backend.services.seed
+   poetry run uvicorn brace_backend.main:app --reload
+   ```
+   The API is available at `http://localhost:8000/api/health`.
+5. **Frontend development loop**
+   ```bash
+   cd packages/frontend
+   npm run dev -- --host
+   ```
+   Visit `http://localhost:4173`; Vite proxies API calls to the backend URL from `.env`.
+6. **Full stack via Docker Compose**
+   ```bash
+   make docker-up          # build + run backend, frontend, postgres, redis
+   make docker-logs        # follow backend/frontend logs
+   make docker-down        # stop stack and wipe volumes
+   ```
+   Frontend is served at `http://localhost`, backend at `http://localhost:8000`.
 7. **Smoke tests / CI validation**
    ```bash
    make smoke
    # or directly:
    docker compose -f infra/docker-compose.prod.yml --profile smoke up --build smoke-tests
    ```
-   The smoke runner resets PostgreSQL, seeds fixtures, hits all public APIs, checks the frontend, and exits non‑zero on any failure.
-
-## Environment Variables
-`.env.example` contains sane defaults; override sensitive values per environment.
-
-| Variable | Purpose | Default |
-| --- | --- | --- |
-| `BRACE_DATABASE_URL` | Async SQLAlchemy DSN for the app | `postgresql+psycopg_async://postgres:postgres@db:5432/brace` |
-| `ALEMBIC_DATABASE_URL` | Sync DSN used by Alembic/entrypoint migrations | `postgresql+psycopg://postgres:postgres@db:5432/brace` |
-| `BRACE_REDIS_URL` | SlowAPI limiter storage | `memory://` locally, overridden to `redis://redis:6379/0` inside Docker |
-| `BRACE_TELEGRAM_BOT_TOKEN` | Required for initData validation | _(set per BotFather)_ |
-| `BRACE_CORS_ORIGINS` | Allowed origins array | `["http://localhost","http://localhost:4173"]` |
-| `VITE_BACKEND_URL` | API base URL compiled into the frontend bundle | `http://localhost:8000` |
-| `VITE_APP_URL` | Public frontend URL for Telegram `/setdomain` | `http://localhost` |
+   The smoke runner resets PostgreSQL, seeds fixtures, hits all public APIs, checks the frontend, and exits non‑zero on any failure. Set `SMOKE_DATABASE_URL` to a dedicated `brace_smoke` database; the runner now refuses to touch databases whose name does not end with `_smoke` to avoid truncating production data.  # PRINCIPAL-FIX
+
+## Environment Variables
+`.env.example` contains sane defaults; override sensitive values per environment.
+
+| Variable | Purpose | Default |
+| --- | --- | --- |
+| `BRACE_DATABASE_URL` | Async SQLAlchemy DSN for the app | `postgresql+psycopg_async://postgres:postgres@db:5432/brace` |
+| `ALEMBIC_DATABASE_URL` | Sync DSN used by Alembic/entrypoint migrations | `postgresql+psycopg://postgres:postgres@db:5432/brace` |
+| `BRACE_REDIS_URL` | SlowAPI limiter storage | `memory://` locally, overridden to `redis://redis:6379/0` inside Docker |
+| `BRACE_TELEGRAM_BOT_TOKEN` | Required for initData validation | _(set per BotFather)_ |
+| `BRACE_CORS_ORIGINS` | Allowed origins array | `["http://localhost","http://localhost:4173"]` |
+| `VITE_BACKEND_URL` | API base URL compiled into the frontend bundle | `http://localhost:8000` |
+| `VITE_APP_URL` | Public frontend URL for Telegram `/setdomain` | `http://localhost` |
+| `SMOKE_DATABASE_URL` | Async DSN **dedicated** to smoke tests (must contain `brace_smoke`) | `postgresql+asyncpg://postgres:postgres@localhost:5432/brace_smoke` |
 | `POSTGRES_USER/PASSWORD/DB` | Docker Compose Postgres bootstrap | `postgres / postgres / brace` |
-
-## API Surface
-| Endpoint | Description |
-| --- | --- |
-| `GET /api/health` | Service heartbeat |
-| `GET /api/products`, `GET /api/products/:id` | Catalog data |
-| `GET/POST/DELETE /api/cart` | Telegram-authenticated cart operations |
-| `GET/POST /api/orders` | Checkout and history |
-| `GET /api/users/me` | Upsert + fetch Telegram user profile |
-| `POST /api/verify-init` | Validate Telegram WebApp init data |
-
-Refer to `packages/backend/tests` for usage examples.
-
-## Testing
-- **Backend unit/integration**: `make backend-test` (requires PostgreSQL reachable at `postgresql://postgres:postgres@localhost:5432/brace_test`; run `docker compose -f infra/docker-compose.prod.yml up -d db redis` beforehand).
-- **Frontend lint/unit**: `cd packages/frontend && npm run lint && npm run test`.
-- **Smoke/e2e**: `make smoke` (wraps `infra/docker-compose.smoke.yml`) or `docker compose -f infra/docker-compose.prod.yml --profile smoke up --abort-on-container-exit smoke-tests`.
-
-## Security & Compliance
-- initData is required on all protected routes via the `X-Telegram-Init-Data` header.
-- FastAPI dependency verifies signature + freshness (5 minute TTL) via HMAC-SHA256.
-- nginx only exposes port 80; backend stays inside Docker network.
-- DOMPurify sanitizes dynamic text pages client-side.
-- SlowAPI enforces `60/minute` rate limit per IP; adjust via `BRACE_RATE_LIMIT`.
-- Rate-limit counters are kept in Redis (Compose) with an automatic in-memory fallback for local development.
-- No secrets are committed; all sensitive data lives in `.env` or CI secrets.
-
-## CI/CD Overview
-GitHub Actions pipeline (`.github/workflows/ci.yml`):
-1. **lint** — Ruff for backend, ESLint for frontend
-2. **typecheck** — mypy-ready toolchain & TypeScript
-3. **test** — pytest (backend) and React Testing Library placeholders (extend as needed)
-4. **build** — Docker build for backend & frontend images
-5. **deploy** — shell stage ready for integration with Render/Railway (uses protected secret gates)
-
-## Telegram Mini App Integration
-1. Create a bot via [@BotFather](https://t.me/BotFather) and capture `BOT_TOKEN`.
-2. Generate a WebApp via `/setdomain` and `/newapp`, pointing to the deployed frontend URL (`FRONTEND_URL`).
-3. Configure the backend URL (`BACKEND_URL`) as the Mini App’s data source for API calls.
-4. Populate `.env`:
-   ```env
-   BRACE_TELEGRAM_BOT_TOKEN=<BOT_TOKEN>
-   BRACE_CORS_ORIGINS=["https://your-frontend-host", "http://localhost"]
-   VITE_BACKEND_URL=https://your-backend-host
-   VITE_APP_URL=https://your-frontend-host
-   ```
-5. Validate connectivity by opening the Mini App inside Telegram; the client automatically calls `/api/verify-init` to ensure signatures match.
-
-For a detailed walk-through (screenshots, manual QA), see `README-verify.md` and `DEPLOY.md`.
+
+## API Surface
+| Endpoint | Description |
+| --- | --- |
+| `GET /api/health` | Service heartbeat |
+| `GET /api/products`, `GET /api/products/:id` | Catalog data |
+| `GET/POST/DELETE /api/cart` | Telegram-authenticated cart operations |
+| `GET/POST /api/orders` | Checkout and history |
+| `GET /api/users/me` | Upsert + fetch Telegram user profile |
+| `POST /api/verify-init` | Validate Telegram WebApp init data |
+
+Refer to `packages/backend/tests` for usage examples.
+
+## Testing
+- **Backend unit/integration**: `make backend-test` (requires PostgreSQL reachable at `postgresql://postgres:postgres@localhost:5432/brace_test`; run `docker compose -f infra/docker-compose.prod.yml up -d db redis` beforehand).
+- **Frontend lint/unit**: `cd packages/frontend && npm run lint && npm run test`.
+- **Smoke/e2e**: `make smoke` (wraps `infra/docker-compose.smoke.yml`) or `docker compose -f infra/docker-compose.prod.yml --profile smoke up --abort-on-container-exit smoke-tests`.
+
+## Security & Compliance
+- initData is required on all protected routes via the `X-Telegram-Init-Data` header.
+- FastAPI dependency verifies signature + freshness (5 minute TTL) via HMAC-SHA256.
+- nginx only exposes port 80; backend stays inside Docker network.
+- DOMPurify sanitizes dynamic text pages client-side.
+- SlowAPI enforces `60/minute` rate limit per IP; adjust via `BRACE_RATE_LIMIT`.
+- Rate-limit counters are kept in Redis (Compose) with an automatic in-memory fallback for local development.
+- No secrets are committed; all sensitive data lives in `.env` or CI secrets.
+
+## CI/CD Overview
+GitHub Actions pipeline (`.github/workflows/ci.yml`):
+1. **lint** — Ruff for backend, ESLint for frontend
+2. **typecheck** — mypy-ready toolchain & TypeScript
+3. **test** — pytest (backend) and React Testing Library placeholders (extend as needed)
+4. **build** — Docker build for backend & frontend images
+5. **deploy** — shell stage ready for integration with Render/Railway (uses protected secret gates)
+
+## Telegram Mini App Integration
+1. Create a bot via [@BotFather](https://t.me/BotFather) and capture `BOT_TOKEN`.
+2. Generate a WebApp via `/setdomain` and `/newapp`, pointing to the deployed frontend URL (`FRONTEND_URL`).
+3. Configure the backend URL (`BACKEND_URL`) as the Mini App’s data source for API calls.
+4. Populate `.env`:
+   ```env
+   BRACE_TELEGRAM_BOT_TOKEN=<BOT_TOKEN>
+   BRACE_CORS_ORIGINS=["https://your-frontend-host", "http://localhost"]
+   VITE_BACKEND_URL=https://your-backend-host
+   VITE_APP_URL=https://your-frontend-host
+   ```
+5. Validate connectivity by opening the Mini App inside Telegram; the client automatically calls `/api/verify-init` to ensure signatures match.
+
+For a detailed walk-through (screenshots, manual QA), see `README-verify.md` and `DEPLOY.md`.

diff --git a/README-verify.md b/README-verify.md
index 557e9c7..ca5bc5d 100644
--- a/README-verify.md
+++ b/README-verify.md
@@ -1,60 +1,62 @@
-# BRACE Verification Guide
-
-Step-by-step checklist for validating the monorepo on Windows, WSL, or Linux.
-
-## 1. Prerequisites
-- Docker Desktop (Windows/macOS) or Docker Engine (Linux)
-- Python 3.12+
-- Node.js 20+
-- Poetry 1.8.x (`pipx install poetry==1.8.3`)
-- npm 10+
-
+# BRACE Verification Guide
+
+Step-by-step checklist for validating the monorepo on Windows, WSL, or Linux.
+
+## 1. Prerequisites
+- Docker Desktop (Windows/macOS) or Docker Engine (Linux)
+- Python 3.12+
+- Node.js 20+
+- Poetry 1.8.x (`pipx install poetry==1.8.3`)
+- npm 10+
+
 ## 2. Environment Setup
 ```bash
 cp .env.example .env
 # edit .env with your secrets (Telegram token, DB passwords, URLs)
 ```
-
-## 3. Backend
-```bash
-cd packages/backend
-poetry install --no-root
-poetry run alembic upgrade head
-poetry run python -m brace_backend.services.seed
-poetry run pytest
-poetry run uvicorn brace_backend.main:app --reload
-```
-Check `http://localhost:8000/api/health`.
-
-## 4. Frontend
-```bash
-cd packages/frontend
-npm install
-npm run lint
-npm run typecheck
-npm run dev -- --host
-```
-Open `http://localhost:4173`.
-
-## 5. End-to-End via Docker
-```bash
-docker compose -f infra/docker-compose.prod.yml up --build
-```
-- Frontend: `http://localhost`
-- Backend: `http://localhost/api/health`
-
+Backend tooling now finds `.env` from the repo root no matter which subdirectory commands run in; set `BRACE_ENV_FILE=/abs/path/.env` if you need to point to a different file.  # PRINCIPAL-FIX
+
+## 3. Backend
+```bash
+cd packages/backend
+poetry install --no-root
+poetry run alembic upgrade head
+poetry run python -m brace_backend.services.seed
+poetry run pytest
+poetry run uvicorn brace_backend.main:app --reload
+```
+Check `http://localhost:8000/api/health`.
+
+## 4. Frontend
+```bash
+cd packages/frontend
+npm install
+npm run lint
+npm run typecheck
+npm run dev -- --host
+```
+Open `http://localhost:4173`.
+
+## 5. End-to-End via Docker
+```bash
+docker compose -f infra/docker-compose.prod.yml up --build
+```
+- Frontend: `http://localhost`
+- Backend: `http://localhost/api/health`
+
 ## 6. Telegram Mini App Smoke Test
 1. In `.env`, ensure `VITE_BACKEND_URL` and `VITE_APP_URL` resolve from Telegram.
-2. Build frontend: `cd packages/frontend && npm run build`.
-3. Deploy following `DEPLOY.md` (Render + Vercel example).
-4. In @BotFather:
-   - `/setdomain` → `<FRONTEND_URL>`
-   - `/newapp` → choose the bot, set platform = `webapp`, start parameter = `brace`
-   - `/setmenubutton` → web_app pointing to `<FRONTEND_URL>`
-5. Open the bot, tap “Open Mini App”.
-6. Inspect browser devtools → Network → confirm `/api/verify-init` returns `{ status: 'verified' }`.
-
-## 7. Teardown
-```bash
-docker compose -f infra/docker-compose.prod.yml down -v
-```
+2. Set `SMOKE_DATABASE_URL` to a dedicated `brace_smoke` database before running `make smoke`—the runner truncates tables on every execution and now enforces that naming convention.  # PRINCIPAL-FIX
+3. Build frontend: `cd packages/frontend && npm run build`.
+4. Deploy following `DEPLOY.md` (Render + Vercel example).
+5. In @BotFather:
+   - `/setdomain` → `<FRONTEND_URL>`
+   - `/newapp` → choose the bot, set platform = `webapp`, start parameter = `brace`
+   - `/setmenubutton` → web_app pointing to `<FRONTEND_URL>`
+6. Open the bot, tap “Open Mini App”.
+7. Inspect browser devtools → Network → confirm `/api/verify-init` returns `{ status: 'verified' }`.
+
+## 7. Teardown
+```bash
+docker compose -f infra/docker-compose.prod.yml down -v
+```

diff --git a/infra/docker-compose.prod.yml b/infra/docker-compose.prod.yml
index 2e2d4b3..44ae336 100644
--- a/infra/docker-compose.prod.yml
+++ b/infra/docker-compose.prod.yml
@@ -1,12 +1,12 @@
-x-backend-build: &backend-build
-  context: ..
-  dockerfile: packages/backend/Dockerfile
-  target: app
-
-x-frontend-build: &frontend-build
-  context: ..
-  dockerfile: packages/frontend/Dockerfile
-
+x-backend-build: &backend-build
+  context: ..
+  dockerfile: packages/backend/Dockerfile
+  target: app
+
+x-frontend-build: &frontend-build
+  context: ..
+  dockerfile: packages/frontend/Dockerfile
+
 services:
   db:
     image: postgres:16-alpine
@@ -20,14 +20,13 @@ services:
         [
           "CMD-SHELL",
           "pg_isready -U $$POSTGRES_USER -d $$POSTGRES_DB",
-        ]
-      interval: 5s
+        ]
+      interval: 5s
       timeout: 5s
       retries: 10
     volumes:
       - db_data:/var/lib/postgresql/data
-    ports:
-      - "5432:5432"
+    # PRINCIPAL-NOTE: DB stays internal-only so production hosts never expose 5432.
 
   redis:
     image: redis:7-alpine
@@ -37,55 +36,58 @@ services:
       interval: 5s
       timeout: 5s
       retries: 10
-    ports:
-      - "6379:6379"
+    # PRINCIPAL-NOTE: Redis is only reachable on the overlay network.
 
   backend:
     build: *backend-build
     env_file:
       - ../.env
     environment:
-      BRACE_DATABASE_URL: postgresql+psycopg_async://postgres:postgres@db:5432/brace
-      ALEMBIC_DATABASE_URL: postgresql+psycopg://postgres:postgres@db:5432/brace
-      BRACE_REDIS_URL: redis://redis:6379/0
-      BRACE_ENVIRONMENT: production
+      BRACE_DATABASE_URL: ${BRACE_DATABASE_URL:-postgresql+psycopg_async://postgres:postgres@db:5432/brace}
+      ALEMBIC_DATABASE_URL: ${ALEMBIC_DATABASE_URL:-postgresql+psycopg://postgres:postgres@db:5432/brace}
+      BRACE_REDIS_URL: ${BRACE_REDIS_URL:-redis://redis:6379/0}
+      BRACE_ENVIRONMENT: ${BRACE_ENVIRONMENT:-production}
+      BRACE_ALLOW_DEV_MODE: ${BRACE_ALLOW_DEV_MODE:-false}
       BRACE_CORS_ORIGINS: ${BRACE_CORS_ORIGINS:-["http://localhost","http://localhost:4173"]}
+      BRACE_TELEGRAM_BOT_TOKEN: ${BRACE_TELEGRAM_BOT_TOKEN:?BRACE_TELEGRAM_BOT_TOKEN is required}
+      BRACE_TELEGRAM_WEBAPP_SECRET: ${BRACE_TELEGRAM_WEBAPP_SECRET:-}
     depends_on:
       db:
         condition: service_healthy
       redis:
         condition: service_healthy
-    ports:
-      - "8000:8000"
-    restart: unless-stopped
-    healthcheck:
-      test:
-        [
-          "CMD-SHELL",
-          "python -c \"import urllib.request; urllib.request.urlopen('http://localhost:8000/api/health')\"",
-        ]
-      interval: 10s
-      timeout: 5s
-      retries: 5
-
+    ports:
+      - "8000:8000"
+    restart: unless-stopped
+    healthcheck:
+      test:
+        [
+          "CMD-SHELL",
+          "python -c \"import urllib.request; urllib.request.urlopen('http://localhost:8000/api/health')\"",
+        ]
+      interval: 10s
+      timeout: 5s
+      retries: 5
+
   frontend:
     build:
       <<: *frontend-build
       args:
         VITE_BACKEND_URL: ${VITE_BACKEND_URL:-http://localhost:8000}
         VITE_APP_URL: ${VITE_APP_URL:-http://localhost}
+        VITE_TG_DEV_MODE: ${VITE_TG_DEV_MODE:-false}
     depends_on:
       backend:
         condition: service_healthy
-    ports:
-      - "80:80"
-    restart: unless-stopped
-    healthcheck:
-      test: ["CMD-SHELL", "wget -qO- http://localhost >/dev/null 2>&1"]
-      interval: 10s
-      timeout: 5s
-      retries: 5
-
+    ports:
+      - "80:80"
+    restart: unless-stopped
+    healthcheck:
+      test: ["CMD-SHELL", "wget -qO- http://localhost >/dev/null 2>&1"]
+      interval: 10s
+      timeout: 5s
+      retries: 5
+
   smoke-tests:
     profiles: ["smoke"]
     build:
@@ -95,20 +97,20 @@ services:
     env_file:
       - ../.env
     environment:
-      SMOKE_DATABASE_URL: postgresql+asyncpg://postgres:postgres@db:5432/brace
-      SMOKE_BACKEND_URL: http://backend:8000
-      SMOKE_FRONTEND_URL: http://frontend
-    depends_on:
-      backend:
-        condition: service_healthy
-      frontend:
-        condition: service_healthy
-      db:
-        condition: service_healthy
-      redis:
-        condition: service_healthy
-    command: ["python", "tests/fullstack_smoke.py"]
-    restart: "no"
-
-volumes:
-  db_data:
+      SMOKE_DATABASE_URL: ${SMOKE_DATABASE_URL:-postgresql+asyncpg://postgres:postgres@db:5432/brace_smoke}
+      SMOKE_BACKEND_URL: ${SMOKE_BACKEND_URL:-http://backend:8000}
+      SMOKE_FRONTEND_URL: ${SMOKE_FRONTEND_URL:-http://frontend}
+    depends_on:
+      backend:
+        condition: service_healthy
+      frontend:
+        condition: service_healthy
+      db:
+        condition: service_healthy
+      redis:
+        condition: service_healthy
+    command: ["python", "tests/fullstack_smoke.py"]
+    restart: "no"
+
+volumes:
+  db_data:

diff --git a/infra/docker-compose.smoke.yml b/infra/docker-compose.smoke.yml
index 2a9ca7d..2e19441 100644
--- a/infra/docker-compose.smoke.yml
+++ b/infra/docker-compose.smoke.yml
@@ -1,102 +1,102 @@
-x-backend-build: &backend-build
-  context: ..
-  dockerfile: packages/backend/Dockerfile
-  target: app
-
-x-smoke-build: &smoke-build
-  context: ..
-  dockerfile: packages/backend/Dockerfile
-  target: smoke-runner
-
-x-frontend-build: &frontend-build
-  context: ..
-  dockerfile: packages/frontend/Dockerfile
-
-services:
-  db:
-    image: postgres:16-alpine
-    environment:
-      POSTGRES_USER: postgres
-      POSTGRES_PASSWORD: postgres
-      POSTGRES_DB: brace
-    healthcheck:
-      test:
-        [
-          "CMD-SHELL",
-          "pg_isready -U $$POSTGRES_USER -d $$POSTGRES_DB",
-        ]
-      interval: 5s
-      timeout: 5s
-      retries: 10
-    volumes:
-      - smoke_db_data:/var/lib/postgresql/data
-
-  redis:
-    image: redis:7-alpine
-    healthcheck:
-      test: ["CMD", "redis-cli", "ping"]
-      interval: 5s
-      timeout: 5s
-      retries: 10
-
-  backend:
-    build: *backend-build
-    env_file:
-      - ../.env
-    environment:
-      BRACE_DATABASE_URL: postgresql+psycopg_async://postgres:postgres@db:5432/brace
-      ALEMBIC_DATABASE_URL: postgresql+psycopg://postgres:postgres@db:5432/brace
-      BRACE_REDIS_URL: redis://redis:6379/0
-      BRACE_ENVIRONMENT: test
-    depends_on:
-      db:
-        condition: service_healthy
-      redis:
-        condition: service_healthy
-    healthcheck:
-      test:
-        [
-          "CMD-SHELL",
-          "python -c \"import urllib.request; urllib.request.urlopen('http://localhost:8000/api/health')\"",
-        ]
-      interval: 10s
-      timeout: 5s
-      retries: 5
-
-  frontend:
-    build:
-      <<: *frontend-build
-      args:
-        VITE_BACKEND_URL: http://backend:8000
-        VITE_APP_URL: http://frontend
-    depends_on:
-      backend:
-        condition: service_healthy
-    healthcheck:
-      test: ["CMD-SHELL", "wget -qO- http://localhost >/dev/null 2>&1"]
-      interval: 10s
-      timeout: 5s
-      retries: 5
-
+x-backend-build: &backend-build
+  context: ..
+  dockerfile: packages/backend/Dockerfile
+  target: app
+
+x-smoke-build: &smoke-build
+  context: ..
+  dockerfile: packages/backend/Dockerfile
+  target: smoke-runner
+
+x-frontend-build: &frontend-build
+  context: ..
+  dockerfile: packages/frontend/Dockerfile
+
+services:
+  db:
+    image: postgres:16-alpine
+    environment:
+      POSTGRES_USER: postgres
+      POSTGRES_PASSWORD: postgres
+      POSTGRES_DB: brace
+    healthcheck:
+      test:
+        [
+          "CMD-SHELL",
+          "pg_isready -U $$POSTGRES_USER -d $$POSTGRES_DB",
+        ]
+      interval: 5s
+      timeout: 5s
+      retries: 10
+    volumes:
+      - smoke_db_data:/var/lib/postgresql/data
+
+  redis:
+    image: redis:7-alpine
+    healthcheck:
+      test: ["CMD", "redis-cli", "ping"]
+      interval: 5s
+      timeout: 5s
+      retries: 10
+
+  backend:
+    build: *backend-build
+    env_file:
+      - ../.env
+    environment:
+      BRACE_DATABASE_URL: postgresql+psycopg_async://postgres:postgres@db:5432/brace
+      ALEMBIC_DATABASE_URL: postgresql+psycopg://postgres:postgres@db:5432/brace
+      BRACE_REDIS_URL: redis://redis:6379/0
+      BRACE_ENVIRONMENT: test
+    depends_on:
+      db:
+        condition: service_healthy
+      redis:
+        condition: service_healthy
+    healthcheck:
+      test:
+        [
+          "CMD-SHELL",
+          "python -c \"import urllib.request; urllib.request.urlopen('http://localhost:8000/api/health')\"",
+        ]
+      interval: 10s
+      timeout: 5s
+      retries: 5
+
+  frontend:
+    build:
+      <<: *frontend-build
+      args:
+        VITE_BACKEND_URL: http://backend:8000
+        VITE_APP_URL: http://frontend
+    depends_on:
+      backend:
+        condition: service_healthy
+    healthcheck:
+      test: ["CMD-SHELL", "wget -qO- http://localhost >/dev/null 2>&1"]
+      interval: 10s
+      timeout: 5s
+      retries: 5
+
   smoke-tests:
-    build: *smoke-build
-    env_file:
-      - ../.env
+    build: *smoke-build
+    env_file:
+      - ../.env
     environment:
-      SMOKE_DATABASE_URL: postgresql+asyncpg://postgres:postgres@db:5432/brace
-      SMOKE_BACKEND_URL: http://backend:8000
-      SMOKE_FRONTEND_URL: http://frontend
-    depends_on:
-      backend:
-        condition: service_healthy
-      frontend:
-        condition: service_healthy
-      db:
-        condition: service_healthy
-      redis:
-        condition: service_healthy
-    command: ["python", "tests/fullstack_smoke.py"]
-    restart: "no"
-
-volumes:
-  smoke_db_data:
+      SMOKE_DATABASE_URL: postgresql+asyncpg://postgres:postgres@db:5432/brace_smoke
+      SMOKE_BACKEND_URL: http://backend:8000
+      SMOKE_FRONTEND_URL: http://frontend
+    depends_on:
+      backend:
+        condition: service_healthy
+      frontend:
+        condition: service_healthy
+      db:
+        condition: service_healthy
+      redis:
+        condition: service_healthy
+    command: ["python", "tests/fullstack_smoke.py"]
+    restart: "no"
+
+volumes:
+  smoke_db_data:

diff --git a/packages/backend/pyproject.toml b/packages/backend/pyproject.toml
index 5638fd6..8c9c3ae 100644
--- a/packages/backend/pyproject.toml
+++ b/packages/backend/pyproject.toml
@@ -1,28 +1,29 @@
-[tool.poetry]
-name = "brace-backend"
-version = "0.2.0"
-description = "BRACE backend service for Telegram Mini App"
-authors = ["Codex <codex@example.com>"]
-readme = "README.md"
-packages = [{ include = "brace_backend", from = "src" }]
-
-[tool.poetry.dependencies]
-python = ">=3.12,<3.15"
-fastapi = "^0.115.0"
-uvicorn = {extras = ["standard"], version = "^0.30.0"}
-SQLAlchemy = "^2.0.32"
-psycopg = {extras = ["binary"], version = "^3.2.1"}
-pydantic-settings = "^2.4.0"
-python-dotenv = "^1.0.1"
-httpx = "^0.27.0"
-passlib = "^1.7.4"
-loguru = "^0.7.2"
-slowapi = "^0.1.9"
-itsdangerous = "^2.2.0"
-alembic = "^1.14.0"
-asyncpg = "^0.30.0"
-redis = {extras = ["hiredis"], version = "^5.2.0"}
-
+[tool.poetry]
+name = "brace-backend"
+version = "0.2.0"
+description = "BRACE backend service for Telegram Mini App"
+authors = ["Codex <codex@example.com>"]
+readme = "README.md"
+packages = [{ include = "brace_backend", from = "src" }]
+
+[tool.poetry.dependencies]
+python = ">=3.12,<3.15"
+fastapi = "^0.115.0"
+uvicorn = {extras = ["standard"], version = "^0.30.0"}
+SQLAlchemy = "^2.0.32"
+psycopg = {extras = ["binary"], version = "^3.2.1"}
+pydantic-settings = "^2.4.0"
+python-dotenv = "^1.0.1"
+httpx = "^0.27.0"
+passlib = "^1.7.4"
+loguru = "^0.7.2"
+slowapi = "^0.1.9"
+itsdangerous = "^2.2.0"
+alembic = "^1.14.0"
+asyncpg = "^0.30.0"
+redis = {extras = ["hiredis"], version = "^5.2.0"}
+pyyaml = "6.0.2"
+
 [tool.poetry.group.dev.dependencies]
 pytest = "^8.3.0"
 pytest-asyncio = "^0.23.7"
@@ -31,33 +32,32 @@ ruff = "^0.5.4"
 black = "^24.4.2"
 factory-boy = "^3.3.0"
 pytest-factoryboy = "^2.7.0"
-aiosqlite = "^0.20.0"
-
-[build-system]
-requires = ["poetry-core>=1.8.2"]
-build-backend = "poetry.core.masonry.api"
-
-[tool.pytest.ini_options]
-asyncio_mode = "auto"
-testpaths = ["tests"]
-pythonpath = ["src"]
-python_files = ["test_*.py"]
-addopts = "--capture=tee-sys"
-
-[tool.black]
-line-length = 100
-target-version = ['py312']
-
-[tool.ruff]
-line-length = 100
-target-version = "py312"
-fix = true  # <— переместили сюда!
-
-[tool.ruff.lint]
-select = ["E", "F", "I", "B", "UP", "N", "RUF"]
-ignore = [
-    "B008",  # FastAPI: использование Depends() в параметрах функций допустимо
-    "E501",  # разрешаем длинные строки (до 100 символов, как в black)
-    "F821",  # forward references в SQLAlchemy (User, Product и т.д.)
-    "RUF003"
-]
+
+[build-system]
+requires = ["poetry-core>=1.8.2"]
+build-backend = "poetry.core.masonry.api"
+
+[tool.pytest.ini_options]
+asyncio_mode = "auto"
+testpaths = ["tests"]
+pythonpath = ["src"]
+python_files = ["test_*.py"]
+addopts = "--capture=tee-sys"
+
+[tool.black]
+line-length = 100
+target-version = ['py312']
+
+[tool.ruff]
+line-length = 100
+target-version = "py312"
+fix = true  # <— переместили сюда!
+
+[tool.ruff.lint]
+select = ["E", "F", "I", "B", "UP", "N", "RUF"]
+ignore = [
+    "B008",  # FastAPI: использование Depends() в параметрах функций допустимо
+    "E501",  # разрешаем длинные строки (до 100 символов, как в black)
+    "F821",  # forward references в SQLAlchemy (User, Product и т.д.)
+    "RUF003"
+]

diff --git a/packages/backend/poetry.lock b/packages/backend/poetry.lock
index 7dc4f0b..af8c2fa 100644
--- a/packages/backend/poetry.lock
+++ b/packages/backend/poetry.lock
@@ -1,23 +1,4 @@
-# This file is automatically @generated by Poetry 2.2.1 and should not be changed by hand.
-
-[[package]]
-name = "aiosqlite"
-version = "0.20.0"
-description = "asyncio bridge to the standard sqlite3 module"
-optional = false
-python-versions = ">=3.8"
-groups = ["dev"]
-files = [
-    {file = "aiosqlite-0.20.0-py3-none-any.whl", hash = "sha256:36a1deaca0cac40ebe32aac9977a6e2bbc7f5189f23f4a54d5908986729e5bd6"},
-    {file = "aiosqlite-0.20.0.tar.gz", hash = "sha256:6d35c8c256637f4672f843c31021464090805bf925385ac39473fb16eaaca3d7"},
-]
-
-[package.dependencies]
-typing_extensions = ">=4.0"
-
-[package.extras]
-dev = ["attribution (==1.7.0)", "black (==24.2.0)", "coverage[toml] (==7.4.1)", "flake8 (==7.0.0)", "flake8-bugbear (==24.2.6)", "flit (==3.9.0)", "mypy (==1.8.0)", "ufmt (==2.3.0)", "usort (==1.0.8.post1)"]
-docs = ["sphinx (==7.2.6)", "sphinx-mdinclude (==0.5.3)"]
+# This file is automatically @generated by Poetry 1.8.3 and should not be changed by hand.
 
 [[package]]
 name = "alembic"
@@ -25,7 +6,6 @@ version = "1.17.1"
 description = "A database migration tool for SQLAlchemy."
 optional = false
 python-versions = ">=3.10"
-groups = ["main"]
 files = [
     {file = "alembic-1.17.1-py3-none-any.whl", hash = "sha256:cbc2386e60f89608bb63f30d2d6cc66c7aaed1fe105bd862828600e5ad167023"},
     {file = "alembic-1.17.1.tar.gz", hash = "sha256:8a289f6778262df31571d29cca4c7fbacd2f0f582ea0816f4c399b6da7528486"},
@@ -45,7 +25,6 @@ version = "0.7.0"
 description = "Reusable constraint types to use with typing.Annotated"
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "annotated_types-0.7.0-py3-none-any.whl", hash = "sha256:1f02e8b43a8fbbc3f3e0d4f0f4bfc8131bcb4eebe8849b8e5c773f3a1c582a53"},
     {file = "annotated_types-0.7.0.tar.gz", hash = "sha256:aff07c09a53a08bc8cfccb9c85b05f1aa9a2a6f23728d790723543408344ce89"},
@@ -57,7 +36,6 @@ version = "4.11.0"
 description = "High-level concurrency and networking framework on top of asyncio or Trio"
 optional = false
 python-versions = ">=3.9"
-groups = ["main"]
 files = [
     {file = "anyio-4.11.0-py3-none-any.whl", hash = "sha256:0287e96f4d26d4149305414d4e3bc32f0dcd0862365a4bddea19d7a1ec38c4fc"},
     {file = "anyio-4.11.0.tar.gz", hash = "sha256:82a8d0b81e318cc5ce71a5f1f8b5c4e63619620b63141ef8c995fa0db95a57c4"},
@@ -77,7 +55,6 @@ version = "0.30.0"
 description = "An asyncio PostgreSQL driver"
 optional = false
 python-versions = ">=3.8.0"
-groups = ["main"]
 files = [
     {file = "asyncpg-0.30.0-cp310-cp310-macosx_10_9_x86_64.whl", hash = "sha256:bfb4dd5ae0699bad2b233672c8fc5ccbd9ad24b89afded02341786887e37927e"},
     {file = "asyncpg-0.30.0-cp310-cp310-macosx_11_0_arm64.whl", hash = "sha256:dc1f62c792752a49f88b7e6f774c26077091b44caceb1983509edc18a2222ec0"},
@@ -132,8 +109,8 @@ files = [
 
 [package.extras]
 docs = ["Sphinx (>=8.1.3,<8.2.0)", "sphinx-rtd-theme (>=1.2.2)"]
-gssauth = ["gssapi ; platform_system != \"Windows\"", "sspilib ; platform_system == \"Windows\""]
-test = ["distro (>=1.9.0,<1.10.0)", "flake8 (>=6.1,<7.0)", "flake8-pyi (>=24.1.0,<24.2.0)", "gssapi ; platform_system == \"Linux\"", "k5test ; platform_system == \"Linux\"", "mypy (>=1.8.0,<1.9.0)", "sspilib ; platform_system == \"Windows\"", "uvloop (>=0.15.3) ; platform_system != \"Windows\" and python_version < \"3.14.0\""]
+gssauth = ["gssapi", "sspilib"]
+test = ["distro (>=1.9.0,<1.10.0)", "flake8 (>=6.1,<7.0)", "flake8-pyi (>=24.1.0,<24.2.0)", "gssapi", "k5test", "mypy (>=1.8.0,<1.9.0)", "sspilib", "uvloop (>=0.15.3)"]
 
 [[package]]
 name = "black"
@@ -141,7 +118,6 @@ version = "24.10.0"
 description = "The uncompromising code formatter."
 optional = false
 python-versions = ">=3.9"
-groups = ["dev"]
 files = [
     {file = "black-24.10.0-cp310-cp310-macosx_10_9_x86_64.whl", hash = "sha256:e6668650ea4b685440857138e5fe40cde4d652633b1bdffc62933d0db4ed9812"},
     {file = "black-24.10.0-cp310-cp310-macosx_11_0_arm64.whl", hash = "sha256:1c536fcf674217e87b8cc3657b81809d3c085d7bf3ef262ead700da345bfa6ea"},
@@ -186,7 +162,6 @@ version = "2025.10.5"
 description = "Python package for providing Mozilla's CA Bundle."
 optional = false
 python-versions = ">=3.7"
-groups = ["main"]
 files = [
     {file = "certifi-2025.10.5-py3-none-any.whl", hash = "sha256:0f212c2744a9bb6de0c56639a6f68afe01ecd92d91f14ae897c4fe7bbeeef0de"},
     {file = "certifi-2025.10.5.tar.gz", hash = "sha256:47c09d31ccf2acf0be3f701ea53595ee7e0b8fa08801c6624be771df09ae7b43"},
@@ -198,7 +173,6 @@ version = "8.3.0"
 description = "Composable command line interface toolkit"
 optional = false
 python-versions = ">=3.10"
-groups = ["main", "dev"]
 files = [
     {file = "click-8.3.0-py3-none-any.whl", hash = "sha256:9b9f285302c6e3064f4330c05f05b81945b2a39544279343e6e7c5f27a9baddc"},
     {file = "click-8.3.0.tar.gz", hash = "sha256:e7b8232224eba16f4ebe410c25ced9f7875cb5f3263ffc93cc3e8da705e229c4"},
@@ -213,8 +187,6 @@ version = "0.4.6"
 description = "Cross-platform colored terminal text."
 optional = false
 python-versions = "!=3.0.*,!=3.1.*,!=3.2.*,!=3.3.*,!=3.4.*,!=3.5.*,!=3.6.*,>=2.7"
-groups = ["main", "dev"]
-markers = "platform_system == \"Windows\" or sys_platform == \"win32\""
 files = [
     {file = "colorama-0.4.6-py2.py3-none-any.whl", hash = "sha256:4f1d9991f5acc0ca119f9d443620b77f9d6b33703e51011c16baf57afb285fc6"},
     {file = "colorama-0.4.6.tar.gz", hash = "sha256:08695f5cb7ed6e0531a20572697297273c47b8cae5a63ffc6d6ed5c201be6e44"},
@@ -226,7 +198,6 @@ version = "7.11.3"
 description = "Code coverage measurement for Python"
 optional = false
 python-versions = ">=3.10"
-groups = ["dev"]
 files = [
     {file = "coverage-7.11.3-cp310-cp310-macosx_10_9_x86_64.whl", hash = "sha256:0c986537abca9b064510f3fd104ba33e98d3036608c7f2f5537f869bc10e1ee5"},
     {file = "coverage-7.11.3-cp310-cp310-macosx_11_0_arm64.whl", hash = "sha256:28c5251b3ab1d23e66f1130ca0c419747edfbcb4690de19467cd616861507af7"},
@@ -323,7 +294,7 @@ files = [
 ]
 
 [package.extras]
-toml = ["tomli ; python_full_version <= \"3.11.0a6\""]
+toml = ["tomli"]
 
 [[package]]
 name = "deprecated"
@@ -331,7 +302,6 @@ version = "1.3.1"
 description = "Python @deprecated decorator to deprecate old python classes, functions or methods."
 optional = false
 python-versions = "!=3.0.*,!=3.1.*,!=3.2.*,!=3.3.*,>=2.7"
-groups = ["main"]
 files = [
     {file = "deprecated-1.3.1-py2.py3-none-any.whl", hash = "sha256:597bfef186b6f60181535a29fbe44865ce137a5079f295b479886c82729d5f3f"},
     {file = "deprecated-1.3.1.tar.gz", hash = "sha256:b1b50e0ff0c1fddaa5708a2c6b0a6588bb09b892825ab2b214ac9ea9d92a5223"},
@@ -341,7 +311,7 @@ files = [
 wrapt = ">=1.10,<3"
 
 [package.extras]
-dev = ["PyTest", "PyTest-Cov", "bump2version (<1)", "setuptools ; python_version >= \"3.12\"", "tox"]
+dev = ["PyTest", "PyTest-Cov", "bump2version (<1)", "setuptools", "tox"]
 
 [[package]]
 name = "factory-boy"
@@ -349,7 +319,6 @@ version = "3.3.3"
 description = "A versatile test fixtures replacement based on thoughtbot's factory_bot for Ruby."
 optional = false
 python-versions = ">=3.8"
-groups = ["dev"]
 files = [
     {file = "factory_boy-3.3.3-py2.py3-none-any.whl", hash = "sha256:1c39e3289f7e667c4285433f305f8d506efc2fe9c73aaea4151ebd5cdea394fc"},
     {file = "factory_boy-3.3.3.tar.gz", hash = "sha256:866862d226128dfac7f2b4160287e899daf54f2612778327dd03d0e2cb1e3d03"},
@@ -368,7 +337,6 @@ version = "38.0.0"
 description = "Faker is a Python package that generates fake data for you."
 optional = false
 python-versions = ">=3.10"
-groups = ["dev"]
 files = [
     {file = "faker-38.0.0-py3-none-any.whl", hash = "sha256:ad4ea6fbfaac2a75d92943e6a79c81f38ecff92378f6541dea9a677ec789a5b2"},
     {file = "faker-38.0.0.tar.gz", hash = "sha256:797aa03fa86982dfb6206918acc10ebf3655bdaa89ddfd3e668d7cc69537331a"},
@@ -383,7 +351,6 @@ version = "0.115.14"
 description = "FastAPI framework, high performance, easy to learn, fast to code, ready for production"
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "fastapi-0.115.14-py3-none-any.whl", hash = "sha256:6c0c8bf9420bd58f565e585036d971872472b4f7d3f6c73b698e10cffdefb3ca"},
     {file = "fastapi-0.115.14.tar.gz", hash = "sha256:b1de15cdc1c499a4da47914db35d0e4ef8f1ce62b624e94e0e5824421df99739"},
@@ -404,8 +371,6 @@ version = "3.2.4"
 description = "Lightweight in-process concurrent programming"
 optional = false
 python-versions = ">=3.9"
-groups = ["main"]
-markers = "platform_machine == \"aarch64\" or platform_machine == \"ppc64le\" or platform_machine == \"x86_64\" or platform_machine == \"amd64\" or platform_machine == \"AMD64\" or platform_machine == \"win32\" or platform_machine == \"WIN32\""
 files = [
     {file = "greenlet-3.2.4-cp310-cp310-macosx_11_0_universal2.whl", hash = "sha256:8c68325b0d0acf8d91dde4e6f930967dd52a5302cd4062932a6b2e7c2969f47c"},
     {file = "greenlet-3.2.4-cp310-cp310-manylinux2014_aarch64.manylinux_2_17_aarch64.whl", hash = "sha256:94385f101946790ae13da500603491f04a76b6e4c059dab271b3ce2e283b2590"},
@@ -485,7 +450,6 @@ version = "0.16.0"
 description = "A pure-Python, bring-your-own-I/O implementation of HTTP/1.1"
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "h11-0.16.0-py3-none-any.whl", hash = "sha256:63cf8bbe7522de3bf65932fda1d9c2772064ffb3dae62d55932da54b31cb6c86"},
     {file = "h11-0.16.0.tar.gz", hash = "sha256:4e35b956cf45792e4caa5885e69fba00bdbc6ffafbfa020300e549b208ee5ff1"},
@@ -497,7 +461,6 @@ version = "3.3.0"
 description = "Python wrapper for hiredis"
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "hiredis-3.3.0-cp310-cp310-macosx_10_15_universal2.whl", hash = "sha256:9937d9b69321b393fbace69f55423480f098120bc55a3316e1ca3508c4dbbd6f"},
     {file = "hiredis-3.3.0-cp310-cp310-macosx_10_15_x86_64.whl", hash = "sha256:50351b77f89ba6a22aff430b993653847f36b71d444509036baa0f2d79d1ebf4"},
@@ -612,7 +575,6 @@ version = "1.0.9"
 description = "A minimal low-level HTTP client."
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "httpcore-1.0.9-py3-none-any.whl", hash = "sha256:2d400746a40668fc9dec9810239072b40b4484b640a8c38fd654a024c7a1bf55"},
     {file = "httpcore-1.0.9.tar.gz", hash = "sha256:6e34463af53fd2ab5d807f399a9b45ea31c3dfa2276f15a2c3f00afff6e176e8"},
@@ -634,7 +596,6 @@ version = "0.7.1"
 description = "A collection of framework independent HTTP protocol utils."
 optional = false
 python-versions = ">=3.9"
-groups = ["main"]
 files = [
     {file = "httptools-0.7.1-cp310-cp310-macosx_10_9_universal2.whl", hash = "sha256:11d01b0ff1fe02c4c32d60af61a4d613b74fad069e47e06e9067758c01e9ac78"},
     {file = "httptools-0.7.1-cp310-cp310-macosx_11_0_arm64.whl", hash = "sha256:84d86c1e5afdc479a6fdabf570be0d3eb791df0ae727e8dbc0259ed1249998d4"},
@@ -687,7 +648,6 @@ version = "0.27.2"
 description = "The next generation HTTP client."
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "httpx-0.27.2-py3-none-any.whl", hash = "sha256:7bb2708e112d8fdd7829cd4243970f0c223274051cb35ee80c03301ee29a3df0"},
     {file = "httpx-0.27.2.tar.gz", hash = "sha256:f7c2be1d2f3c3c3160d441802406b206c2b76f5947b11115e6df10c6c65e66c2"},
@@ -701,7 +661,7 @@ idna = "*"
 sniffio = "*"
 
 [package.extras]
-brotli = ["brotli ; platform_python_implementation == \"CPython\"", "brotlicffi ; platform_python_implementation != \"CPython\""]
+brotli = ["brotli", "brotlicffi"]
 cli = ["click (==8.*)", "pygments (==2.*)", "rich (>=10,<14)"]
 http2 = ["h2 (>=3,<5)"]
 socks = ["socksio (==1.*)"]
@@ -713,7 +673,6 @@ version = "3.11"
 description = "Internationalized Domain Names in Applications (IDNA)"
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "idna-3.11-py3-none-any.whl", hash = "sha256:771a87f49d9defaf64091e6e6fe9c18d4833f140bd19464795bc32d966ca37ea"},
     {file = "idna-3.11.tar.gz", hash = "sha256:795dafcc9c04ed0c1fb032c2aa73654d8e8c5023a7df64a53f39190ada629902"},
@@ -728,7 +687,6 @@ version = "0.5.1"
 description = "A port of Ruby on Rails inflector to Python"
 optional = false
 python-versions = ">=3.5"
-groups = ["dev"]
 files = [
     {file = "inflection-0.5.1-py2.py3-none-any.whl", hash = "sha256:f38b2b640938a4f35ade69ac3d053042959b62a0f1076a5bbaa1b9526605a8a2"},
     {file = "inflection-0.5.1.tar.gz", hash = "sha256:1a29730d366e996aaacffb2f1f1cb9593dc38e2ddd30c91250c6dde09ea9b417"},
@@ -740,7 +698,6 @@ version = "2.3.0"
 description = "brain-dead simple config-ini parsing"
 optional = false
 python-versions = ">=3.10"
-groups = ["dev"]
 files = [
     {file = "iniconfig-2.3.0-py3-none-any.whl", hash = "sha256:f631c04d2c48c52b84d0d0549c99ff3859c98df65b3101406327ecc7d53fbf12"},
     {file = "iniconfig-2.3.0.tar.gz", hash = "sha256:c76315c77db068650d49c5b56314774a7804df16fee4402c1f19d6d15d8c4730"},
@@ -752,7 +709,6 @@ version = "2.2.0"
 description = "Safely pass data to untrusted environments and back."
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "itsdangerous-2.2.0-py3-none-any.whl", hash = "sha256:c6242fc49e35958c8b15141343aa660db5fc54d4f13a1db01a3f5891b98700ef"},
     {file = "itsdangerous-2.2.0.tar.gz", hash = "sha256:e0050c0b7da1eea53ffaf149c0cfbb5c6e2e2b69c4bef22c81fa6eb73e5f6173"},
@@ -764,7 +720,6 @@ version = "5.6.0"
 description = "Rate limiting utilities"
 optional = false
 python-versions = ">=3.10"
-groups = ["main"]
 files = [
     {file = "limits-5.6.0-py3-none-any.whl", hash = "sha256:b585c2104274528536a5b68864ec3835602b3c4a802cd6aa0b07419798394021"},
     {file = "limits-5.6.0.tar.gz", hash = "sha256:807fac75755e73912e894fdd61e2838de574c5721876a19f7ab454ae1fffb4b5"},
@@ -792,7 +747,6 @@ version = "0.7.3"
 description = "Python logging made (stupidly) simple"
 optional = false
 python-versions = "<4.0,>=3.5"
-groups = ["main"]
 files = [
     {file = "loguru-0.7.3-py3-none-any.whl", hash = "sha256:31a33c10c8e1e10422bfd431aeb5d351c7cf7fa671e3c4df004162264b28220c"},
     {file = "loguru-0.7.3.tar.gz", hash = "sha256:19480589e77d47b8d85b2c827ad95d49bf31b0dcde16593892eb51dd18706eb6"},
@@ -803,7 +757,7 @@ colorama = {version = ">=0.3.4", markers = "sys_platform == \"win32\""}
 win32-setctime = {version = ">=1.0.0", markers = "sys_platform == \"win32\""}
 
 [package.extras]
-dev = ["Sphinx (==8.1.3) ; python_version >= \"3.11\"", "build (==1.2.2) ; python_version >= \"3.11\"", "colorama (==0.4.5) ; python_version < \"3.8\"", "colorama (==0.4.6) ; python_version >= \"3.8\"", "exceptiongroup (==1.1.3) ; python_version >= \"3.7\" and python_version < \"3.11\"", "freezegun (==1.1.0) ; python_version < \"3.8\"", "freezegun (==1.5.0) ; python_version >= \"3.8\"", "mypy (==v0.910) ; python_version < \"3.6\"", "mypy (==v0.971) ; python_version == \"3.6\"", "mypy (==v1.13.0) ; python_version >= \"3.8\"", "mypy (==v1.4.1) ; python_version == \"3.7\"", "myst-parser (==4.0.0) ; python_version >= \"3.11\"", "pre-commit (==4.0.1) ; python_version >= \"3.9\"", "pytest (==6.1.2) ; python_version < \"3.8\"", "pytest (==8.3.2) ; python_version >= \"3.8\"", "pytest-cov (==2.12.1) ; python_version < \"3.8\"", "pytest-cov (==5.0.0) ; python_version == \"3.8\"", "pytest-cov (==6.0.0) ; python_version >= \"3.9\"", "pytest-mypy-plugins (==1.9.3) ; python_version >= \"3.6\" and python_version < \"3.8\"", "pytest-mypy-plugins (==3.1.0) ; python_version >= \"3.8\"", "sphinx-rtd-theme (==3.0.2) ; python_version >= \"3.11\"", "tox (==3.27.1) ; python_version < \"3.8\"", "tox (==4.23.2) ; python_version >= \"3.8\"", "twine (==6.0.1) ; python_version >= \"3.11\""]
+dev = ["Sphinx (==8.1.3)", "build (==1.2.2)", "colorama (==0.4.5)", "colorama (==0.4.6)", "exceptiongroup (==1.1.3)", "freezegun (==1.1.0)", "freezegun (==1.5.0)", "mypy (==v0.910)", "mypy (==v0.971)", "mypy (==v1.13.0)", "mypy (==v1.4.1)", "myst-parser (==4.0.0)", "pre-commit (==4.0.1)", "pytest (==6.1.2)", "pytest (==8.3.2)", "pytest-cov (==2.12.1)", "pytest-cov (==5.0.0)", "pytest-cov (==6.0.0)", "pytest-mypy-plugins (==1.9.3)", "pytest-mypy-plugins (==3.1.0)", "sphinx-rtd-theme (==3.0.2)", "tox (==3.27.1)", "tox (==4.23.2)", "twine (==6.0.1)"]
 
 [[package]]
 name = "mako"
@@ -811,7 +765,6 @@ version = "1.3.10"
 description = "A super-fast templating language that borrows the best ideas from the existing templating languages."
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "mako-1.3.10-py3-none-any.whl", hash = "sha256:baef24a52fc4fc514a0887ac600f9f1cff3d82c61d4d700a1fa84d597b88db59"},
     {file = "mako-1.3.10.tar.gz", hash = "sha256:99579a6f39583fa7e5630a28c3c1f440e4e97a414b80372649c0ce338da2ea28"},
@@ -831,7 +784,6 @@ version = "3.0.3"
 description = "Safely add untrusted strings to HTML/XML markup."
 optional = false
 python-versions = ">=3.9"
-groups = ["main"]
 files = [
     {file = "markupsafe-3.0.3-cp310-cp310-macosx_10_9_x86_64.whl", hash = "sha256:2f981d352f04553a7171b8e44369f2af4055f888dfb147d55e42d29e29e74559"},
     {file = "markupsafe-3.0.3-cp310-cp310-macosx_11_0_arm64.whl", hash = "sha256:e1c1493fb6e50ab01d20a22826e57520f1284df32f2d8601fdd90b6304601419"},
@@ -930,7 +882,6 @@ version = "1.1.0"
 description = "Type system extensions for programs checked with the mypy type checker."
 optional = false
 python-versions = ">=3.8"
-groups = ["dev"]
 files = [
     {file = "mypy_extensions-1.1.0-py3-none-any.whl", hash = "sha256:1be4cccdb0f2482337c4743e60421de3a356cd97508abadd57d47403e94f5505"},
     {file = "mypy_extensions-1.1.0.tar.gz", hash = "sha256:52e68efc3284861e772bbcd66823fde5ae21fd2fdb51c62a211403730b916558"},
@@ -942,7 +893,6 @@ version = "25.0"
 description = "Core utilities for Python packages"
 optional = false
 python-versions = ">=3.8"
-groups = ["main", "dev"]
 files = [
     {file = "packaging-25.0-py3-none-any.whl", hash = "sha256:29572ef2b1f17581046b3a2227d5c611fb25ec70ca1ba8554b24b0e69331a484"},
     {file = "packaging-25.0.tar.gz", hash = "sha256:d443872c98d677bf60f6a1f2f8c1cb748e8fe762d2bf9d3148b5599295b0fc4f"},
@@ -954,7 +904,6 @@ version = "1.7.4"
 description = "comprehensive password hashing framework supporting over 30 schemes"
 optional = false
 python-versions = "*"
-groups = ["main"]
 files = [
     {file = "passlib-1.7.4-py2.py3-none-any.whl", hash = "sha256:aa6bca462b8d8bda89c70b382f0c298a20b5560af6cbfa2dce410c0a2fb669f1"},
     {file = "passlib-1.7.4.tar.gz", hash = "sha256:defd50f72b65c5402ab2c573830a6978e5f202ad0d984793c8dde2c4152ebe04"},
@@ -972,7 +921,6 @@ version = "0.12.1"
 description = "Utility library for gitignore style pattern matching of file paths."
 optional = false
 python-versions = ">=3.8"
-groups = ["dev"]
 files = [
     {file = "pathspec-0.12.1-py3-none-any.whl", hash = "sha256:a0d503e138a4c123b27490a4f7beda6a01c6f288df0e4a8b79c7eb0dc7b4cc08"},
     {file = "pathspec-0.12.1.tar.gz", hash = "sha256:a482d51503a1ab33b1c67a6c3813a26953dbdc71c31dacaef9a838c4e29f5712"},
@@ -984,7 +932,6 @@ version = "4.5.0"
 description = "A small Python package for determining appropriate platform-specific dirs, e.g. a `user data dir`."
 optional = false
 python-versions = ">=3.10"
-groups = ["dev"]
 files = [
     {file = "platformdirs-4.5.0-py3-none-any.whl", hash = "sha256:e578a81bb873cbb89a41fcc904c7ef523cc18284b7e3b3ccf06aca1403b7ebd3"},
     {file = "platformdirs-4.5.0.tar.gz", hash = "sha256:70ddccdd7c99fc5942e9fc25636a8b34d04c24b335100223152c2803e4063312"},
@@ -1001,7 +948,6 @@ version = "1.6.0"
 description = "plugin and hook calling mechanisms for python"
 optional = false
 python-versions = ">=3.9"
-groups = ["dev"]
 files = [
     {file = "pluggy-1.6.0-py3-none-any.whl", hash = "sha256:e920276dd6813095e9377c0bc5566d94c932c33b27a3e3945d8389c374dd4746"},
     {file = "pluggy-1.6.0.tar.gz", hash = "sha256:7dcc130b76258d33b90f61b658791dede3486c3e6bfb003ee5c9bfb396dd22f3"},
@@ -1017,7 +963,6 @@ version = "3.2.12"
 description = "PostgreSQL database adapter for Python"
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "psycopg-3.2.12-py3-none-any.whl", hash = "sha256:8a1611a2d4c16ae37eada46438be9029a35bb959bb50b3d0e1e93c0f3d54c9ee"},
     {file = "psycopg-3.2.12.tar.gz", hash = "sha256:85c08d6f6e2a897b16280e0ff6406bef29b1327c045db06d21f364d7cd5da90b"},
@@ -1029,8 +974,8 @@ typing-extensions = {version = ">=4.6", markers = "python_version < \"3.13\""}
 tzdata = {version = "*", markers = "sys_platform == \"win32\""}
 
 [package.extras]
-binary = ["psycopg-binary (==3.2.12) ; implementation_name != \"pypy\""]
-c = ["psycopg-c (==3.2.12) ; implementation_name != \"pypy\""]
+binary = ["psycopg-binary (==3.2.12)"]
+c = ["psycopg-c (==3.2.12)"]
 dev = ["ast-comments (>=1.1.2)", "black (>=24.1.0)", "codespell (>=2.2)", "dnspython (>=2.1)", "flake8 (>=4.0)", "isort-psycopg", "isort[colors] (>=6.0)", "mypy (>=1.14)", "pre-commit (>=4.0.1)", "types-setuptools (>=57.4)", "types-shapely (>=2.0)", "wheel (>=0.37)"]
 docs = ["Sphinx (>=5.0)", "furo (==2022.6.21)", "sphinx-autobuild (>=2021.3.14)", "sphinx-autodoc-typehints (>=1.12)"]
 pool = ["psycopg-pool"]
@@ -1042,8 +987,6 @@ version = "3.2.12"
 description = "PostgreSQL database adapter for Python -- C optimisation distribution"
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
-markers = "implementation_name != \"pypy\""
 files = [
     {file = "psycopg_binary-3.2.12-cp310-cp310-macosx_10_9_x86_64.whl", hash = "sha256:13cd057f406d2c8063ae8b489395b089a7f23c39aff223b5ea39f0c4dd640550"},
     {file = "psycopg_binary-3.2.12-cp310-cp310-macosx_11_0_arm64.whl", hash = "sha256:ef92d5ba6213de060d1390b1f71f5c3b2fbb00b4d55edee39f3b07234538b64a"},
@@ -1115,7 +1058,6 @@ version = "2.12.4"
 description = "Data validation using Python type hints"
 optional = false
 python-versions = ">=3.9"
-groups = ["main"]
 files = [
     {file = "pydantic-2.12.4-py3-none-any.whl", hash = "sha256:92d3d202a745d46f9be6df459ac5a064fdaa3c1c4cd8adcfa332ccf3c05f871e"},
     {file = "pydantic-2.12.4.tar.gz", hash = "sha256:0f8cb9555000a4b5b617f66bfd2566264c4984b27589d3b845685983e8ea85ac"},
@@ -1129,7 +1071,7 @@ typing-inspection = ">=0.4.2"
 
 [package.extras]
 email = ["email-validator (>=2.0.0)"]
-timezone = ["tzdata ; python_version >= \"3.9\" and platform_system == \"Windows\""]
+timezone = ["tzdata"]
 
 [[package]]
 name = "pydantic-core"
@@ -1137,7 +1079,6 @@ version = "2.41.5"
 description = "Core functionality for Pydantic validation and serialization"
 optional = false
 python-versions = ">=3.9"
-groups = ["main"]
 files = [
     {file = "pydantic_core-2.41.5-cp310-cp310-macosx_10_12_x86_64.whl", hash = "sha256:77b63866ca88d804225eaa4af3e664c5faf3568cea95360d21f4725ab6e07146"},
     {file = "pydantic_core-2.41.5-cp310-cp310-macosx_11_0_arm64.whl", hash = "sha256:dfa8a0c812ac681395907e71e1274819dec685fec28273a28905df579ef137e2"},
@@ -1271,7 +1212,6 @@ version = "2.12.0"
 description = "Settings management using Pydantic"
 optional = false
 python-versions = ">=3.10"
-groups = ["main"]
 files = [
     {file = "pydantic_settings-2.12.0-py3-none-any.whl", hash = "sha256:fddb9fd99a5b18da837b29710391e945b1e30c135477f484084ee513adb93809"},
     {file = "pydantic_settings-2.12.0.tar.gz", hash = "sha256:005538ef951e3c2a68e1c08b292b5f2e71490def8589d4221b95dab00dafcfd0"},
@@ -1295,7 +1235,6 @@ version = "2.19.2"
 description = "Pygments is a syntax highlighting package written in Python."
 optional = false
 python-versions = ">=3.8"
-groups = ["dev"]
 files = [
     {file = "pygments-2.19.2-py3-none-any.whl", hash = "sha256:86540386c03d588bb81d44bc3928634ff26449851e99741617ecb9037ee5ec0b"},
     {file = "pygments-2.19.2.tar.gz", hash = "sha256:636cb2477cec7f8952536970bc533bc43743542f70392ae026374600add5b887"},
@@ -1310,7 +1249,6 @@ version = "2.10.1"
 description = "JSON Web Token implementation in Python"
 optional = false
 python-versions = ">=3.9"
-groups = ["main"]
 files = [
     {file = "PyJWT-2.10.1-py3-none-any.whl", hash = "sha256:dcdd193e30abefd5debf142f9adfcdd2b58004e644f25406ffaebd50bd98dacb"},
     {file = "pyjwt-2.10.1.tar.gz", hash = "sha256:3cc5772eb20009233caf06e9d8a0577824723b44e6648ee0a2aedb6cf9381953"},
@@ -1328,7 +1266,6 @@ version = "8.4.2"
 description = "pytest: simple powerful testing with Python"
 optional = false
 python-versions = ">=3.9"
-groups = ["dev"]
 files = [
     {file = "pytest-8.4.2-py3-none-any.whl", hash = "sha256:872f880de3fc3a5bdc88a11b39c9710c3497a547cfa9320bc3c5e62fbf272e79"},
     {file = "pytest-8.4.2.tar.gz", hash = "sha256:86c0d0b93306b961d58d62a4db4879f27fe25513d4b969df351abdddb3c30e01"},
@@ -1350,7 +1287,6 @@ version = "0.23.8"
 description = "Pytest support for asyncio"
 optional = false
 python-versions = ">=3.8"
-groups = ["dev"]
 files = [
     {file = "pytest_asyncio-0.23.8-py3-none-any.whl", hash = "sha256:50265d892689a5faefb84df80819d1ecef566eb3549cf915dfb33569359d1ce2"},
     {file = "pytest_asyncio-0.23.8.tar.gz", hash = "sha256:759b10b33a6dc61cce40a8bd5205e302978bbbcc00e279a8b61d9a6a3c82e4d3"},
@@ -1369,7 +1305,6 @@ version = "5.0.0"
 description = "Pytest plugin for measuring coverage."
 optional = false
 python-versions = ">=3.8"
-groups = ["dev"]
 files = [
     {file = "pytest-cov-5.0.0.tar.gz", hash = "sha256:5837b58e9f6ebd335b0f8060eecce69b662415b16dc503883a02f45dfeb14857"},
     {file = "pytest_cov-5.0.0-py3-none-any.whl", hash = "sha256:4f0764a1219df53214206bf1feea4633c3b558a2925c8b59f144f682861ce652"},
@@ -1388,7 +1323,6 @@ version = "2.8.1"
 description = "Factory Boy support for pytest."
 optional = false
 python-versions = ">=3.9"
-groups = ["dev"]
 files = [
     {file = "pytest_factoryboy-2.8.1-py3-none-any.whl", hash = "sha256:91c762cb236bf34b11efdf2e54bafae33114488235621e8b2c4bd9fd77838784"},
     {file = "pytest_factoryboy-2.8.1.tar.gz", hash = "sha256:2221d48b31b8b8ccaa739c6a162fb50a43a4de6dff6043f249d2807a3462548d"},
@@ -1407,7 +1341,6 @@ version = "1.2.1"
 description = "Read key-value pairs from a .env file and set them as environment variables"
 optional = false
 python-versions = ">=3.9"
-groups = ["main"]
 files = [
     {file = "python_dotenv-1.2.1-py3-none-any.whl", hash = "sha256:b81ee9561e9ca4004139c6cbba3a238c32b03e4894671e181b671e8cb8425d61"},
     {file = "python_dotenv-1.2.1.tar.gz", hash = "sha256:42667e897e16ab0d66954af0e60a9caa94f0fd4ecf3aaf6d2d260eec1aa36ad6"},
@@ -1418,85 +1351,64 @@ cli = ["click (>=5.0)"]
 
 [[package]]
 name = "pyyaml"
-version = "6.0.3"
+version = "6.0.2"
 description = "YAML parser and emitter for Python"
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
-    {file = "PyYAML-6.0.3-cp38-cp38-macosx_10_13_x86_64.whl", hash = "sha256:c2514fceb77bc5e7a2f7adfaa1feb2fb311607c9cb518dbc378688ec73d8292f"},
-    {file = "PyYAML-6.0.3-cp38-cp38-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:9c57bb8c96f6d1808c030b1687b9b5fb476abaa47f0db9c0101f5e9f394e97f4"},
-    {file = "PyYAML-6.0.3-cp38-cp38-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:efd7b85f94a6f21e4932043973a7ba2613b059c4a000551892ac9f1d11f5baf3"},
-    {file = "PyYAML-6.0.3-cp38-cp38-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:22ba7cfcad58ef3ecddc7ed1db3409af68d023b7f940da23c6c2a1890976eda6"},
-    {file = "PyYAML-6.0.3-cp38-cp38-musllinux_1_2_x86_64.whl", hash = "sha256:6344df0d5755a2c9a276d4473ae6b90647e216ab4757f8426893b5dd2ac3f369"},
-    {file = "PyYAML-6.0.3-cp38-cp38-win32.whl", hash = "sha256:3ff07ec89bae51176c0549bc4c63aa6202991da2d9a6129d7aef7f1407d3f295"},
-    {file = "PyYAML-6.0.3-cp38-cp38-win_amd64.whl", hash = "sha256:5cf4e27da7e3fbed4d6c3d8e797387aaad68102272f8f9752883bc32d61cb87b"},
-    {file = "pyyaml-6.0.3-cp310-cp310-macosx_10_13_x86_64.whl", hash = "sha256:214ed4befebe12df36bcc8bc2b64b396ca31be9304b8f59e25c11cf94a4c033b"},
-    {file = "pyyaml-6.0.3-cp310-cp310-macosx_11_0_arm64.whl", hash = "sha256:02ea2dfa234451bbb8772601d7b8e426c2bfa197136796224e50e35a78777956"},
-    {file = "pyyaml-6.0.3-cp310-cp310-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:b30236e45cf30d2b8e7b3e85881719e98507abed1011bf463a8fa23e9c3e98a8"},
-    {file = "pyyaml-6.0.3-cp310-cp310-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:66291b10affd76d76f54fad28e22e51719ef9ba22b29e1d7d03d6777a9174198"},
-    {file = "pyyaml-6.0.3-cp310-cp310-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:9c7708761fccb9397fe64bbc0395abcae8c4bf7b0eac081e12b809bf47700d0b"},
-    {file = "pyyaml-6.0.3-cp310-cp310-musllinux_1_2_aarch64.whl", hash = "sha256:418cf3f2111bc80e0933b2cd8cd04f286338bb88bdc7bc8e6dd775ebde60b5e0"},
-    {file = "pyyaml-6.0.3-cp310-cp310-musllinux_1_2_x86_64.whl", hash = "sha256:5e0b74767e5f8c593e8c9b5912019159ed0533c70051e9cce3e8b6aa699fcd69"},
-    {file = "pyyaml-6.0.3-cp310-cp310-win32.whl", hash = "sha256:28c8d926f98f432f88adc23edf2e6d4921ac26fb084b028c733d01868d19007e"},
-    {file = "pyyaml-6.0.3-cp310-cp310-win_amd64.whl", hash = "sha256:bdb2c67c6c1390b63c6ff89f210c8fd09d9a1217a465701eac7316313c915e4c"},
-    {file = "pyyaml-6.0.3-cp311-cp311-macosx_10_13_x86_64.whl", hash = "sha256:44edc647873928551a01e7a563d7452ccdebee747728c1080d881d68af7b997e"},
-    {file = "pyyaml-6.0.3-cp311-cp311-macosx_11_0_arm64.whl", hash = "sha256:652cb6edd41e718550aad172851962662ff2681490a8a711af6a4d288dd96824"},
-    {file = "pyyaml-6.0.3-cp311-cp311-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:10892704fc220243f5305762e276552a0395f7beb4dbf9b14ec8fd43b57f126c"},
-    {file = "pyyaml-6.0.3-cp311-cp311-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:850774a7879607d3a6f50d36d04f00ee69e7fc816450e5f7e58d7f17f1ae5c00"},
-    {file = "pyyaml-6.0.3-cp311-cp311-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:b8bb0864c5a28024fac8a632c443c87c5aa6f215c0b126c449ae1a150412f31d"},
-    {file = "pyyaml-6.0.3-cp311-cp311-musllinux_1_2_aarch64.whl", hash = "sha256:1d37d57ad971609cf3c53ba6a7e365e40660e3be0e5175fa9f2365a379d6095a"},
-    {file = "pyyaml-6.0.3-cp311-cp311-musllinux_1_2_x86_64.whl", hash = "sha256:37503bfbfc9d2c40b344d06b2199cf0e96e97957ab1c1b546fd4f87e53e5d3e4"},
-    {file = "pyyaml-6.0.3-cp311-cp311-win32.whl", hash = "sha256:8098f252adfa6c80ab48096053f512f2321f0b998f98150cea9bd23d83e1467b"},
-    {file = "pyyaml-6.0.3-cp311-cp311-win_amd64.whl", hash = "sha256:9f3bfb4965eb874431221a3ff3fdcddc7e74e3b07799e0e84ca4a0f867d449bf"},
-    {file = "pyyaml-6.0.3-cp312-cp312-macosx_10_13_x86_64.whl", hash = "sha256:7f047e29dcae44602496db43be01ad42fc6f1cc0d8cd6c83d342306c32270196"},
-    {file = "pyyaml-6.0.3-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:fc09d0aa354569bc501d4e787133afc08552722d3ab34836a80547331bb5d4a0"},
-    {file = "pyyaml-6.0.3-cp312-cp312-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:9149cad251584d5fb4981be1ecde53a1ca46c891a79788c0df828d2f166bda28"},
-    {file = "pyyaml-6.0.3-cp312-cp312-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:5fdec68f91a0c6739b380c83b951e2c72ac0197ace422360e6d5a959d8d97b2c"},
-    {file = "pyyaml-6.0.3-cp312-cp312-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:ba1cc08a7ccde2d2ec775841541641e4548226580ab850948cbfda66a1befcdc"},
-    {file = "pyyaml-6.0.3-cp312-cp312-musllinux_1_2_aarch64.whl", hash = "sha256:8dc52c23056b9ddd46818a57b78404882310fb473d63f17b07d5c40421e47f8e"},
-    {file = "pyyaml-6.0.3-cp312-cp312-musllinux_1_2_x86_64.whl", hash = "sha256:41715c910c881bc081f1e8872880d3c650acf13dfa8214bad49ed4cede7c34ea"},
-    {file = "pyyaml-6.0.3-cp312-cp312-win32.whl", hash = "sha256:96b533f0e99f6579b3d4d4995707cf36df9100d67e0c8303a0c55b27b5f99bc5"},
-    {file = "pyyaml-6.0.3-cp312-cp312-win_amd64.whl", hash = "sha256:5fcd34e47f6e0b794d17de1b4ff496c00986e1c83f7ab2fb8fcfe9616ff7477b"},
-    {file = "pyyaml-6.0.3-cp312-cp312-win_arm64.whl", hash = "sha256:64386e5e707d03a7e172c0701abfb7e10f0fb753ee1d773128192742712a98fd"},
-    {file = "pyyaml-6.0.3-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:8da9669d359f02c0b91ccc01cac4a67f16afec0dac22c2ad09f46bee0697eba8"},
-    {file = "pyyaml-6.0.3-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:2283a07e2c21a2aa78d9c4442724ec1eb15f5e42a723b99cb3d822d48f5f7ad1"},
-    {file = "pyyaml-6.0.3-cp313-cp313-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:ee2922902c45ae8ccada2c5b501ab86c36525b883eff4255313a253a3160861c"},
-    {file = "pyyaml-6.0.3-cp313-cp313-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:a33284e20b78bd4a18c8c2282d549d10bc8408a2a7ff57653c0cf0b9be0afce5"},
-    {file = "pyyaml-6.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:0f29edc409a6392443abf94b9cf89ce99889a1dd5376d94316ae5145dfedd5d6"},
-    {file = "pyyaml-6.0.3-cp313-cp313-musllinux_1_2_aarch64.whl", hash = "sha256:f7057c9a337546edc7973c0d3ba84ddcdf0daa14533c2065749c9075001090e6"},
-    {file = "pyyaml-6.0.3-cp313-cp313-musllinux_1_2_x86_64.whl", hash = "sha256:eda16858a3cab07b80edaf74336ece1f986ba330fdb8ee0d6c0d68fe82bc96be"},
-    {file = "pyyaml-6.0.3-cp313-cp313-win32.whl", hash = "sha256:d0eae10f8159e8fdad514efdc92d74fd8d682c933a6dd088030f3834bc8e6b26"},
-    {file = "pyyaml-6.0.3-cp313-cp313-win_amd64.whl", hash = "sha256:79005a0d97d5ddabfeeea4cf676af11e647e41d81c9a7722a193022accdb6b7c"},
-    {file = "pyyaml-6.0.3-cp313-cp313-win_arm64.whl", hash = "sha256:5498cd1645aa724a7c71c8f378eb29ebe23da2fc0d7a08071d89469bf1d2defb"},
-    {file = "pyyaml-6.0.3-cp314-cp314-macosx_10_13_x86_64.whl", hash = "sha256:8d1fab6bb153a416f9aeb4b8763bc0f22a5586065f86f7664fc23339fc1c1fac"},
-    {file = "pyyaml-6.0.3-cp314-cp314-macosx_11_0_arm64.whl", hash = "sha256:34d5fcd24b8445fadc33f9cf348c1047101756fd760b4dacb5c3e99755703310"},
-    {file = "pyyaml-6.0.3-cp314-cp314-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:501a031947e3a9025ed4405a168e6ef5ae3126c59f90ce0cd6f2bfc477be31b7"},
-    {file = "pyyaml-6.0.3-cp314-cp314-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:b3bc83488de33889877a0f2543ade9f70c67d66d9ebb4ac959502e12de895788"},
-    {file = "pyyaml-6.0.3-cp314-cp314-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:c458b6d084f9b935061bc36216e8a69a7e293a2f1e68bf956dcd9e6cbcd143f5"},
-    {file = "pyyaml-6.0.3-cp314-cp314-musllinux_1_2_aarch64.whl", hash = "sha256:7c6610def4f163542a622a73fb39f534f8c101d690126992300bf3207eab9764"},
-    {file = "pyyaml-6.0.3-cp314-cp314-musllinux_1_2_x86_64.whl", hash = "sha256:5190d403f121660ce8d1d2c1bb2ef1bd05b5f68533fc5c2ea899bd15f4399b35"},
-    {file = "pyyaml-6.0.3-cp314-cp314-win_amd64.whl", hash = "sha256:4a2e8cebe2ff6ab7d1050ecd59c25d4c8bd7e6f400f5f82b96557ac0abafd0ac"},
-    {file = "pyyaml-6.0.3-cp314-cp314-win_arm64.whl", hash = "sha256:93dda82c9c22deb0a405ea4dc5f2d0cda384168e466364dec6255b293923b2f3"},
-    {file = "pyyaml-6.0.3-cp314-cp314t-macosx_10_13_x86_64.whl", hash = "sha256:02893d100e99e03eda1c8fd5c441d8c60103fd175728e23e431db1b589cf5ab3"},
-    {file = "pyyaml-6.0.3-cp314-cp314t-macosx_11_0_arm64.whl", hash = "sha256:c1ff362665ae507275af2853520967820d9124984e0f7466736aea23d8611fba"},
-    {file = "pyyaml-6.0.3-cp314-cp314t-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:6adc77889b628398debc7b65c073bcb99c4a0237b248cacaf3fe8a557563ef6c"},
-    {file = "pyyaml-6.0.3-cp314-cp314t-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:a80cb027f6b349846a3bf6d73b5e95e782175e52f22108cfa17876aaeff93702"},
-    {file = "pyyaml-6.0.3-cp314-cp314t-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:00c4bdeba853cc34e7dd471f16b4114f4162dc03e6b7afcc2128711f0eca823c"},
-    {file = "pyyaml-6.0.3-cp314-cp314t-musllinux_1_2_aarch64.whl", hash = "sha256:66e1674c3ef6f541c35191caae2d429b967b99e02040f5ba928632d9a7f0f065"},
-    {file = "pyyaml-6.0.3-cp314-cp314t-musllinux_1_2_x86_64.whl", hash = "sha256:16249ee61e95f858e83976573de0f5b2893b3677ba71c9dd36b9cf8be9ac6d65"},
-    {file = "pyyaml-6.0.3-cp314-cp314t-win_amd64.whl", hash = "sha256:4ad1906908f2f5ae4e5a8ddfce73c320c2a1429ec52eafd27138b7f1cbe341c9"},
-    {file = "pyyaml-6.0.3-cp314-cp314t-win_arm64.whl", hash = "sha256:ebc55a14a21cb14062aa4162f906cd962b28e2e9ea38f9b4391244cd8de4ae0b"},
-    {file = "pyyaml-6.0.3-cp39-cp39-macosx_10_13_x86_64.whl", hash = "sha256:b865addae83924361678b652338317d1bd7e79b1f4596f96b96c77a5a34b34da"},
-    {file = "pyyaml-6.0.3-cp39-cp39-macosx_11_0_arm64.whl", hash = "sha256:c3355370a2c156cffb25e876646f149d5d68f5e0a3ce86a5084dd0b64a994917"},
-    {file = "pyyaml-6.0.3-cp39-cp39-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl", hash = "sha256:3c5677e12444c15717b902a5798264fa7909e41153cdf9ef7ad571b704a63dd9"},
-    {file = "pyyaml-6.0.3-cp39-cp39-manylinux2014_s390x.manylinux_2_17_s390x.manylinux_2_28_s390x.whl", hash = "sha256:5ed875a24292240029e4483f9d4a4b8a1ae08843b9c54f43fcc11e404532a8a5"},
-    {file = "pyyaml-6.0.3-cp39-cp39-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl", hash = "sha256:0150219816b6a1fa26fb4699fb7daa9caf09eb1999f3b70fb6e786805e80375a"},
-    {file = "pyyaml-6.0.3-cp39-cp39-musllinux_1_2_aarch64.whl", hash = "sha256:fa160448684b4e94d80416c0fa4aac48967a969efe22931448d853ada8baf926"},
-    {file = "pyyaml-6.0.3-cp39-cp39-musllinux_1_2_x86_64.whl", hash = "sha256:27c0abcb4a5dac13684a37f76e701e054692a9b2d3064b70f5e4eb54810553d7"},
-    {file = "pyyaml-6.0.3-cp39-cp39-win32.whl", hash = "sha256:1ebe39cb5fc479422b83de611d14e2c0d3bb2a18bbcb01f229ab3cfbd8fee7a0"},
-    {file = "pyyaml-6.0.3-cp39-cp39-win_amd64.whl", hash = "sha256:2e71d11abed7344e42a8849600193d15b6def118602c4c176f748e4583246007"},
-    {file = "pyyaml-6.0.3.tar.gz", hash = "sha256:d76623373421df22fb4cf8817020cbb7ef15c725b9d5e45f17e189bfc384190f"},
+    {file = "PyYAML-6.0.2-cp310-cp310-macosx_10_9_x86_64.whl", hash = "sha256:0a9a2848a5b7feac301353437eb7d5957887edbf81d56e903999a75a3d743086"},
+    {file = "PyYAML-6.0.2-cp310-cp310-macosx_11_0_arm64.whl", hash = "sha256:29717114e51c84ddfba879543fb232a6ed60086602313ca38cce623c1d62cfbf"},
+    {file = "PyYAML-6.0.2-cp310-cp310-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:8824b5a04a04a047e72eea5cec3bc266db09e35de6bdfe34c9436ac5ee27d237"},
+    {file = "PyYAML-6.0.2-cp310-cp310-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:7c36280e6fb8385e520936c3cb3b8042851904eba0e58d277dca80a5cfed590b"},
+    {file = "PyYAML-6.0.2-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:ec031d5d2feb36d1d1a24380e4db6d43695f3748343d99434e6f5f9156aaa2ed"},
+    {file = "PyYAML-6.0.2-cp310-cp310-musllinux_1_1_aarch64.whl", hash = "sha256:936d68689298c36b53b29f23c6dbb74de12b4ac12ca6cfe0e047bedceea56180"},
+    {file = "PyYAML-6.0.2-cp310-cp310-musllinux_1_1_x86_64.whl", hash = "sha256:23502f431948090f597378482b4812b0caae32c22213aecf3b55325e049a6c68"},
+    {file = "PyYAML-6.0.2-cp310-cp310-win32.whl", hash = "sha256:2e99c6826ffa974fe6e27cdb5ed0021786b03fc98e5ee3c5bfe1fd5015f42b99"},
+    {file = "PyYAML-6.0.2-cp310-cp310-win_amd64.whl", hash = "sha256:a4d3091415f010369ae4ed1fc6b79def9416358877534caf6a0fdd2146c87a3e"},
+    {file = "PyYAML-6.0.2-cp311-cp311-macosx_10_9_x86_64.whl", hash = "sha256:cc1c1159b3d456576af7a3e4d1ba7e6924cb39de8f67111c735f6fc832082774"},
+    {file = "PyYAML-6.0.2-cp311-cp311-macosx_11_0_arm64.whl", hash = "sha256:1e2120ef853f59c7419231f3bf4e7021f1b936f6ebd222406c3b60212205d2ee"},
+    {file = "PyYAML-6.0.2-cp311-cp311-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:5d225db5a45f21e78dd9358e58a98702a0302f2659a3c6cd320564b75b86f47c"},
+    {file = "PyYAML-6.0.2-cp311-cp311-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:5ac9328ec4831237bec75defaf839f7d4564be1e6b25ac710bd1a96321cc8317"},
+    {file = "PyYAML-6.0.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:3ad2a3decf9aaba3d29c8f537ac4b243e36bef957511b4766cb0057d32b0be85"},
+    {file = "PyYAML-6.0.2-cp311-cp311-musllinux_1_1_aarch64.whl", hash = "sha256:ff3824dc5261f50c9b0dfb3be22b4567a6f938ccce4587b38952d85fd9e9afe4"},
+    {file = "PyYAML-6.0.2-cp311-cp311-musllinux_1_1_x86_64.whl", hash = "sha256:797b4f722ffa07cc8d62053e4cff1486fa6dc094105d13fea7b1de7d8bf71c9e"},
+    {file = "PyYAML-6.0.2-cp311-cp311-win32.whl", hash = "sha256:11d8f3dd2b9c1207dcaf2ee0bbbfd5991f571186ec9cc78427ba5bd32afae4b5"},
+    {file = "PyYAML-6.0.2-cp311-cp311-win_amd64.whl", hash = "sha256:e10ce637b18caea04431ce14fabcf5c64a1c61ec9c56b071a4b7ca131ca52d44"},
+    {file = "PyYAML-6.0.2-cp312-cp312-macosx_10_9_x86_64.whl", hash = "sha256:c70c95198c015b85feafc136515252a261a84561b7b1d51e3384e0655ddf25ab"},
+    {file = "PyYAML-6.0.2-cp312-cp312-macosx_11_0_arm64.whl", hash = "sha256:ce826d6ef20b1bc864f0a68340c8b3287705cae2f8b4b1d932177dcc76721725"},
+    {file = "PyYAML-6.0.2-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:1f71ea527786de97d1a0cc0eacd1defc0985dcf6b3f17bb77dcfc8c34bec4dc5"},
+    {file = "PyYAML-6.0.2-cp312-cp312-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:9b22676e8097e9e22e36d6b7bda33190d0d400f345f23d4065d48f4ca7ae0425"},
+    {file = "PyYAML-6.0.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:80bab7bfc629882493af4aa31a4cfa43a4c57c83813253626916b8c7ada83476"},
+    {file = "PyYAML-6.0.2-cp312-cp312-musllinux_1_1_aarch64.whl", hash = "sha256:0833f8694549e586547b576dcfaba4a6b55b9e96098b36cdc7ebefe667dfed48"},
+    {file = "PyYAML-6.0.2-cp312-cp312-musllinux_1_1_x86_64.whl", hash = "sha256:8b9c7197f7cb2738065c481a0461e50ad02f18c78cd75775628afb4d7137fb3b"},
+    {file = "PyYAML-6.0.2-cp312-cp312-win32.whl", hash = "sha256:ef6107725bd54b262d6dedcc2af448a266975032bc85ef0172c5f059da6325b4"},
+    {file = "PyYAML-6.0.2-cp312-cp312-win_amd64.whl", hash = "sha256:7e7401d0de89a9a855c839bc697c079a4af81cf878373abd7dc625847d25cbd8"},
+    {file = "PyYAML-6.0.2-cp313-cp313-macosx_10_13_x86_64.whl", hash = "sha256:efdca5630322a10774e8e98e1af481aad470dd62c3170801852d752aa7a783ba"},
+    {file = "PyYAML-6.0.2-cp313-cp313-macosx_11_0_arm64.whl", hash = "sha256:50187695423ffe49e2deacb8cd10510bc361faac997de9efef88badc3bb9e2d1"},
+    {file = "PyYAML-6.0.2-cp313-cp313-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:0ffe8360bab4910ef1b9e87fb812d8bc0a308b0d0eef8c8f44e0254ab3b07133"},
+    {file = "PyYAML-6.0.2-cp313-cp313-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:17e311b6c678207928d649faa7cb0d7b4c26a0ba73d41e99c4fff6b6c3276484"},
+    {file = "PyYAML-6.0.2-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:70b189594dbe54f75ab3a1acec5f1e3faa7e8cf2f1e08d9b561cb41b845f69d5"},
+    {file = "PyYAML-6.0.2-cp313-cp313-musllinux_1_1_aarch64.whl", hash = "sha256:41e4e3953a79407c794916fa277a82531dd93aad34e29c2a514c2c0c5fe971cc"},
+    {file = "PyYAML-6.0.2-cp313-cp313-musllinux_1_1_x86_64.whl", hash = "sha256:68ccc6023a3400877818152ad9a1033e3db8625d899c72eacb5a668902e4d652"},
+    {file = "PyYAML-6.0.2-cp313-cp313-win32.whl", hash = "sha256:bc2fa7c6b47d6bc618dd7fb02ef6fdedb1090ec036abab80d4681424b84c1183"},
+    {file = "PyYAML-6.0.2-cp313-cp313-win_amd64.whl", hash = "sha256:8388ee1976c416731879ac16da0aff3f63b286ffdd57cdeb95f3f2e085687563"},
+    {file = "PyYAML-6.0.2-cp38-cp38-macosx_10_9_x86_64.whl", hash = "sha256:24471b829b3bf607e04e88d79542a9d48bb037c2267d7927a874e6c205ca7e9a"},
+    {file = "PyYAML-6.0.2-cp38-cp38-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:d7fded462629cfa4b685c5416b949ebad6cec74af5e2d42905d41e257e0869f5"},
+    {file = "PyYAML-6.0.2-cp38-cp38-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:d84a1718ee396f54f3a086ea0a66d8e552b2ab2017ef8b420e92edbc841c352d"},
+    {file = "PyYAML-6.0.2-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:9056c1ecd25795207ad294bcf39f2db3d845767be0ea6e6a34d856f006006083"},
+    {file = "PyYAML-6.0.2-cp38-cp38-musllinux_1_1_x86_64.whl", hash = "sha256:82d09873e40955485746739bcb8b4586983670466c23382c19cffecbf1fd8706"},
+    {file = "PyYAML-6.0.2-cp38-cp38-win32.whl", hash = "sha256:43fa96a3ca0d6b1812e01ced1044a003533c47f6ee8aca31724f78e93ccc089a"},
+    {file = "PyYAML-6.0.2-cp38-cp38-win_amd64.whl", hash = "sha256:01179a4a8559ab5de078078f37e5c1a30d76bb88519906844fd7bdea1b7729ff"},
+    {file = "PyYAML-6.0.2-cp39-cp39-macosx_10_9_x86_64.whl", hash = "sha256:688ba32a1cffef67fd2e9398a2efebaea461578b0923624778664cc1c914db5d"},
+    {file = "PyYAML-6.0.2-cp39-cp39-macosx_11_0_arm64.whl", hash = "sha256:a8786accb172bd8afb8be14490a16625cbc387036876ab6ba70912730faf8e1f"},
+    {file = "PyYAML-6.0.2-cp39-cp39-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:d8e03406cac8513435335dbab54c0d385e4a49e4945d2909a581c83647ca0290"},
+    {file = "PyYAML-6.0.2-cp39-cp39-manylinux_2_17_s390x.manylinux2014_s390x.whl", hash = "sha256:f753120cb8181e736c57ef7636e83f31b9c0d1722c516f7e86cf15b7aa57ff12"},
+    {file = "PyYAML-6.0.2-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", hash = "sha256:3b1fdb9dc17f5a7677423d508ab4f243a726dea51fa5e70992e59a7411c89d19"},
+    {file = "PyYAML-6.0.2-cp39-cp39-musllinux_1_1_aarch64.whl", hash = "sha256:0b69e4ce7a131fe56b7e4d770c67429700908fc0752af059838b1cfb41960e4e"},
+    {file = "PyYAML-6.0.2-cp39-cp39-musllinux_1_1_x86_64.whl", hash = "sha256:a9f8c2e67970f13b16084e04f134610fd1d374bf477b17ec1599185cf611d725"},
+    {file = "PyYAML-6.0.2-cp39-cp39-win32.whl", hash = "sha256:6395c297d42274772abc367baaa79683958044e5d3835486c16da75d2a694631"},
+    {file = "PyYAML-6.0.2-cp39-cp39-win_amd64.whl", hash = "sha256:39693e1f8320ae4f43943590b49779ffb98acb81f788220ea932a6b6c51004d8"},
+    {file = "pyyaml-6.0.2.tar.gz", hash = "sha256:d584d9ec91ad65861cc08d42e834324ef890a082e591037abe114850ff7bbc3e"},
 ]
 
 [[package]]
@@ -1505,7 +1417,6 @@ version = "5.3.1"
 description = "Python client for Redis database and key-value store"
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "redis-5.3.1-py3-none-any.whl", hash = "sha256:dc1909bd24669cc31b5f67a039700b16ec30571096c5f1f0d9d2324bff31af97"},
     {file = "redis-5.3.1.tar.gz", hash = "sha256:ca49577a531ea64039b5a36db3d6cd1a0c7a60c34124d46924a45b956e8cf14c"},
@@ -1525,7 +1436,6 @@ version = "0.5.7"
 description = "An extremely fast Python linter and code formatter, written in Rust."
 optional = false
 python-versions = ">=3.7"
-groups = ["dev"]
 files = [
     {file = "ruff-0.5.7-py3-none-linux_armv6l.whl", hash = "sha256:548992d342fc404ee2e15a242cdbea4f8e39a52f2e7752d0e4cbe88d2d2f416a"},
     {file = "ruff-0.5.7-py3-none-macosx_10_12_x86_64.whl", hash = "sha256:00cc8872331055ee017c4f1071a8a31ca0809ccc0657da1d154a1d2abac5c0be"},
@@ -1553,7 +1463,6 @@ version = "0.1.9"
 description = "A rate limiting extension for Starlette and Fastapi"
 optional = false
 python-versions = ">=3.7,<4.0"
-groups = ["main"]
 files = [
     {file = "slowapi-0.1.9-py3-none-any.whl", hash = "sha256:cfad116cfb84ad9d763ee155c1e5c5cbf00b0d47399a769b227865f5df576e36"},
     {file = "slowapi-0.1.9.tar.gz", hash = "sha256:639192d0f1ca01b1c6d95bf6c71d794c3a9ee189855337b4821f7f457dddad77"},
@@ -1571,7 +1480,6 @@ version = "1.3.1"
 description = "Sniff out which async library your code is running under"
 optional = false
 python-versions = ">=3.7"
-groups = ["main"]
 files = [
     {file = "sniffio-1.3.1-py3-none-any.whl", hash = "sha256:2f6da418d1f1e0fddd844478f41680e794e6051915791a034ff65e5f100525a2"},
     {file = "sniffio-1.3.1.tar.gz", hash = "sha256:f4324edc670a0f49750a81b895f35c3adb843cca46f0530f79fc1babb23789dc"},
@@ -1583,7 +1491,6 @@ version = "2.0.44"
 description = "Database Abstraction Library"
 optional = false
 python-versions = ">=3.7"
-groups = ["main"]
 files = [
     {file = "SQLAlchemy-2.0.44-cp37-cp37m-macosx_10_9_x86_64.whl", hash = "sha256:471733aabb2e4848d609141a9e9d56a427c0a038f4abf65dd19d7a21fd563632"},
     {file = "SQLAlchemy-2.0.44-cp37-cp37m-manylinux_2_17_aarch64.manylinux2014_aarch64.whl", hash = "sha256:48bf7d383a35e668b984c805470518b635d48b95a3c57cb03f37eaa3551b5f9f"},
@@ -1679,7 +1586,6 @@ version = "0.46.2"
 description = "The little ASGI library that shines."
 optional = false
 python-versions = ">=3.9"
-groups = ["main"]
 files = [
     {file = "starlette-0.46.2-py3-none-any.whl", hash = "sha256:595633ce89f8ffa71a015caed34a5b2dc1c0cdb3f0f1fbd1e69339cf2abeec35"},
     {file = "starlette-0.46.2.tar.gz", hash = "sha256:7f7361f34eed179294600af672f565727419830b54b7b084efe44bb82d2fccd5"},
@@ -1697,7 +1603,6 @@ version = "4.15.0"
 description = "Backported and Experimental Type Hints for Python 3.9+"
 optional = false
 python-versions = ">=3.9"
-groups = ["main", "dev"]
 files = [
     {file = "typing_extensions-4.15.0-py3-none-any.whl", hash = "sha256:f0fa19c6845758ab08074a0cfa8b7aecb71c999ca73d62883bc25cc018c4e548"},
     {file = "typing_extensions-4.15.0.tar.gz", hash = "sha256:0cea48d173cc12fa28ecabc3b837ea3cf6f38c6d1136f85cbaaf598984861466"},
@@ -1709,7 +1614,6 @@ version = "0.4.2"
 description = "Runtime typing introspection tools"
 optional = false
 python-versions = ">=3.9"
-groups = ["main"]
 files = [
     {file = "typing_inspection-0.4.2-py3-none-any.whl", hash = "sha256:4ed1cacbdc298c220f1bd249ed5287caa16f34d44ef4e9c3d0cbad5b521545e7"},
     {file = "typing_inspection-0.4.2.tar.gz", hash = "sha256:ba561c48a67c5958007083d386c3295464928b01faa735ab8547c5692e87f464"},
@@ -1724,12 +1628,10 @@ version = "2025.2"
 description = "Provider of IANA time zone data"
 optional = false
 python-versions = ">=2"
-groups = ["main", "dev"]
 files = [
     {file = "tzdata-2025.2-py2.py3-none-any.whl", hash = "sha256:1a403fada01ff9221ca8044d701868fa132215d84beb92242d9acd2147f667a8"},
     {file = "tzdata-2025.2.tar.gz", hash = "sha256:b60a638fcc0daffadf82fe0f57e53d06bdec2f36c4df66280ae79bce6bd6f2b9"},
 ]
-markers = {main = "sys_platform == \"win32\""}
 
 [[package]]
 name = "uvicorn"
@@ -1737,7 +1639,6 @@ version = "0.30.6"
 description = "The lightning-fast ASGI server."
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "uvicorn-0.30.6-py3-none-any.whl", hash = "sha256:65fd46fe3fda5bdc1b03b94eb634923ff18cd35b2f084813ea79d1f103f711b5"},
     {file = "uvicorn-0.30.6.tar.gz", hash = "sha256:4b15decdda1e72be08209e860a1e10e92439ad5b97cf44cc945fcbee66fc5788"},
@@ -1750,12 +1651,12 @@ h11 = ">=0.8"
 httptools = {version = ">=0.5.0", optional = true, markers = "extra == \"standard\""}
 python-dotenv = {version = ">=0.13", optional = true, markers = "extra == \"standard\""}
 pyyaml = {version = ">=5.1", optional = true, markers = "extra == \"standard\""}
-uvloop = {version = ">=0.14.0,<0.15.0 || >0.15.0,<0.15.1 || >0.15.1", optional = true, markers = "sys_platform != \"win32\" and sys_platform != \"cygwin\" and platform_python_implementation != \"PyPy\" and extra == \"standard\""}
+uvloop = {version = ">=0.14.0,<0.15.0 || >0.15.0,<0.15.1 || >0.15.1", optional = true, markers = "(sys_platform != \"win32\" and sys_platform != \"cygwin\") and platform_python_implementation != \"PyPy\" and extra == \"standard\""}
 watchfiles = {version = ">=0.13", optional = true, markers = "extra == \"standard\""}
 websockets = {version = ">=10.4", optional = true, markers = "extra == \"standard\""}
 
 [package.extras]
-standard = ["colorama (>=0.4) ; sys_platform == \"win32\"", "httptools (>=0.5.0)", "python-dotenv (>=0.13)", "pyyaml (>=5.1)", "uvloop (>=0.14.0,!=0.15.0,!=0.15.1) ; sys_platform != \"win32\" and sys_platform != \"cygwin\" and platform_python_implementation != \"PyPy\"", "watchfiles (>=0.13)", "websockets (>=10.4)"]
+standard = ["colorama (>=0.4)", "httptools (>=0.5.0)", "python-dotenv (>=0.13)", "pyyaml (>=5.1)", "uvloop (>=0.14.0,!=0.15.0,!=0.15.1)", "watchfiles (>=0.13)", "websockets (>=10.4)"]
 
 [[package]]
 name = "uvloop"
@@ -1763,8 +1664,6 @@ version = "0.22.1"
 description = "Fast implementation of asyncio event loop on top of libuv"
 optional = false
 python-versions = ">=3.8.1"
-groups = ["main"]
-markers = "sys_platform != \"win32\" and sys_platform != \"cygwin\" and platform_python_implementation != \"PyPy\""
 files = [
     {file = "uvloop-0.22.1-cp310-cp310-macosx_10_9_universal2.whl", hash = "sha256:ef6f0d4cc8a9fa1f6a910230cd53545d9a14479311e87e3cb225495952eb672c"},
     {file = "uvloop-0.22.1-cp310-cp310-macosx_10_9_x86_64.whl", hash = "sha256:7cd375a12b71d33d46af85a3343b35d98e8116134ba404bd657b3b1d15988792"},
@@ -1828,7 +1727,6 @@ version = "1.1.1"
 description = "Simple, modern and high performance file watching and code reload in python."
 optional = false
 python-versions = ">=3.9"
-groups = ["main"]
 files = [
     {file = "watchfiles-1.1.1-cp310-cp310-macosx_10_12_x86_64.whl", hash = "sha256:eef58232d32daf2ac67f42dea51a2c80f0d03379075d44a587051e63cc2e368c"},
     {file = "watchfiles-1.1.1-cp310-cp310-macosx_11_0_arm64.whl", hash = "sha256:03fa0f5237118a0c5e496185cafa92878568b652a2e9a9382a5151b1a0380a43"},
@@ -1950,7 +1848,6 @@ version = "15.0.1"
 description = "An implementation of the WebSocket Protocol (RFC 6455 & 7692)"
 optional = false
 python-versions = ">=3.9"
-groups = ["main"]
 files = [
     {file = "websockets-15.0.1-cp310-cp310-macosx_10_9_universal2.whl", hash = "sha256:d63efaa0cd96cf0c5fe4d581521d9fa87744540d4bc999ae6e08595a1014b45b"},
     {file = "websockets-15.0.1-cp310-cp310-macosx_10_9_x86_64.whl", hash = "sha256:ac60e3b188ec7574cb761b08d50fcedf9d77f1530352db4eef1707fe9dee7205"},
@@ -2029,15 +1926,13 @@ version = "1.2.0"
 description = "A small Python utility to set file creation time on Windows"
 optional = false
 python-versions = ">=3.5"
-groups = ["main"]
-markers = "sys_platform == \"win32\""
 files = [
     {file = "win32_setctime-1.2.0-py3-none-any.whl", hash = "sha256:95d644c4e708aba81dc3704a116d8cbc974d70b3bdb8be1d150e36be6e9d1390"},
     {file = "win32_setctime-1.2.0.tar.gz", hash = "sha256:ae1fdf948f5640aae05c511ade119313fb6a30d7eabe25fef9764dca5873c4c0"},
 ]
 
 [package.extras]
-dev = ["black (>=19.3b0) ; python_version >= \"3.6\"", "pytest (>=4.6.2)"]
+dev = ["black (>=19.3b0)", "pytest (>=4.6.2)"]
 
 [[package]]
 name = "wrapt"
@@ -2045,7 +1940,6 @@ version = "2.0.1"
 description = "Module for decorators, wrappers and monkey patching."
 optional = false
 python-versions = ">=3.8"
-groups = ["main"]
 files = [
     {file = "wrapt-2.0.1-cp310-cp310-macosx_10_9_universal2.whl", hash = "sha256:64b103acdaa53b7caf409e8d45d39a8442fe6dcfec6ba3f3d141e0cc2b5b4dbd"},
     {file = "wrapt-2.0.1-cp310-cp310-macosx_10_9_x86_64.whl", hash = "sha256:91bcc576260a274b169c3098e9a3519fb01f2989f6d3d386ef9cbf8653de1374"},
@@ -2160,6 +2054,6 @@ files = [
 dev = ["pytest", "setuptools"]
 
 [metadata]
-lock-version = "2.1"
+lock-version = "2.0"
 python-versions = ">=3.12,<3.15"
-content-hash = "4772858c0c192a317ddc15c4b70284f764fcc81372f5d1d37f89b78c4019c678"
+content-hash = "fce79ee7767bb0835ae33861ed9a3a09b48bde18b9e004c56b917aad5c9683fb"

diff --git a/packages/backend/src/brace_backend/core/config.py b/packages/backend/src/brace_backend/core/config.py
index 6d916f1..21df728 100644
--- a/packages/backend/src/brace_backend/core/config.py
+++ b/packages/backend/src/brace_backend/core/config.py
@@ -1,40 +1,61 @@
-from __future__ import annotations
-
+from __future__ import annotations
+
+import os
 from functools import lru_cache
+from pathlib import Path
 from typing import Any
 
 from pydantic import Field, ValidationError
 from pydantic_settings import BaseSettings, SettingsConfigDict
 
 
-class Settings(BaseSettings):
-    """Strongly-typed application settings that are shared across ASGI, workers, and tooling."""
+_MONOREPO_ROOT = Path(__file__).resolve().parents[4]
+_BACKEND_ROOT = Path(__file__).resolve().parents[3]
+_DEFAULT_ENV_FILES = (".env", ".env.local")
+
+
+def _resolve_env_files() -> tuple[str, ...]:
+    env_override = os.getenv("BRACE_ENV_FILE")
+    if env_override:
+        return (env_override,)
 
-    app_name: str = "BRACE Backend"
-    environment: str = "development"
+    candidates: list[str] = []
+    for base_dir in (_MONOREPO_ROOT, _BACKEND_ROOT):
+        for filename in _DEFAULT_ENV_FILES:
+            candidates.append(str(base_dir / filename))
+
+    return tuple(dict.fromkeys(candidates))  # preserve order without duplicates
+
+
+class Settings(BaseSettings):
+    """Strongly-typed application settings that are shared across ASGI, workers, and tooling."""
+
+    app_name: str = "BRACE Backend"
+    environment: str = "development"
     log_level: str = "INFO"
     log_json: bool = True
     log_format: str = (
         "{time:YYYY-MM-DD HH:mm:ss.SSS} | {level} | trace_id={extra[trace_id]} | {message}"
     )
     trace_header: str = "X-Trace-Id"
-
-    # Psycopg's async driver ships pre-built wheels, so it stays compatible with Python 3.14+
-    # without requiring users to compile asyncpg locally.
-    database_url: str = "postgresql+psycopg_async://postgres:postgres@db:5432/brace"
-    database_echo: bool = False
-    database_pool_size: int = 5
-    database_max_overflow: int = 5
-    redis_url: str = "memory://"
-
-    # ### IMPORTANT — Place BRACE_TELEGRAM_BOT_TOKEN in production environments:
-    # # .env
-    # # infra/docker-compose.prod.yml
-    # # k8s/deploy.yaml
-    telegram_bot_token: str = Field(..., min_length=1)
-
-    telegram_webapp_secret: str | None = None
-    telegram_dev_mode: bool = False
+    allow_dev_mode: bool = False  # PRINCIPAL-NOTE: Dev-only shortcuts require explicit opt-in.
+
+    # Psycopg's async driver ships pre-built wheels, so it stays compatible with Python 3.14+
+    # without requiring users to compile asyncpg locally.
+    database_url: str = "postgresql+psycopg_async://postgres:postgres@db:5432/brace"
+    database_echo: bool = False
+    database_pool_size: int = 5
+    database_max_overflow: int = 5
+    redis_url: str = "memory://"
+
+    # ### IMPORTANT — Place BRACE_TELEGRAM_BOT_TOKEN in production environments:
+    # # .env
+    # # infra/docker-compose.prod.yml
+    # # k8s/deploy.yaml
+    telegram_bot_token: str = Field(..., min_length=1)
+
+    telegram_webapp_secret: str | None = None
+    telegram_dev_mode: bool = False
     telegram_dev_user: dict[str, Any] = {
         "id": 999_000,
         "first_name": "Dev",
@@ -43,24 +64,35 @@ class Settings(BaseSettings):
         "language_code": "en",
     }
 
-    cors_origins: list[str] = ["http://localhost", "http://localhost:4173"]
-
-    rate_limit: str = "60/minute"
+    @property
+    def telegram_dev_mode_enabled(self) -> bool:
+        """Only allow Telegram WebApp dev payloads in trusted developer environments."""
+        return (
+            self.environment.lower() == "development"
+            and self.allow_dev_mode
+            and self.telegram_dev_mode
+        )
 
+    cors_origins: list[str] = ["http://localhost", "http://localhost:4173"]
+
+    rate_limit: str = "60/minute"
+
     model_config = SettingsConfigDict(
-        env_file=(".env", ".env.local"), env_prefix="BRACE_", extra="ignore"
+        env_file=_resolve_env_files(),  # PRINCIPAL-FIX: load monorepo-root .env consistently
+        env_prefix="BRACE_",
+        extra="ignore",
     )
-
-
-@lru_cache(maxsize=1)
-def get_settings() -> Settings:
-    try:
-        return Settings()
-    except ValidationError as exc:  # pragma: no cover - fails fast during startup
-        raise RuntimeError(
-            "BRACE_TELEGRAM_BOT_TOKEN is required. Add it to .env, "
-            "infra/docker-compose.prod.yml, and k8s/deploy.yaml."
-        ) from exc
-
-
-settings = get_settings()
+
+
+@lru_cache(maxsize=1)
+def get_settings() -> Settings:
+    try:
+        return Settings()
+    except ValidationError as exc:  # pragma: no cover - fails fast during startup
+        raise RuntimeError(
+            "BRACE_TELEGRAM_BOT_TOKEN is required. Add it to .env, "
+            "infra/docker-compose.prod.yml, and k8s/deploy.yaml."
+        ) from exc
+
+
+settings = get_settings()

diff --git a/packages/backend/src/brace_backend/db/seed.py b/packages/backend/src/brace_backend/db/seed.py
index 66f9d61..81fc093 100644
--- a/packages/backend/src/brace_backend/db/seed.py
+++ b/packages/backend/src/brace_backend/db/seed.py
@@ -1,8 +1,8 @@
-from __future__ import annotations
-
-import logging
-import os
-from decimal import Decimal
+from __future__ import annotations
+
+import logging
+import os
+import uuid
 
 from sqlalchemy import func, select
 from sqlalchemy.engine import Engine, create_engine
@@ -10,46 +10,57 @@ from sqlalchemy.orm import Session
 
 from brace_backend.core.config import settings
 from brace_backend.core.database import ensure_sync_dsn
+from brace_backend.core.money import to_minor_units
 from brace_backend.domain.product import Product, ProductVariant
-
-LOG = logging.getLogger("brace_backend.db.seed")
-
-
-def _engine() -> Engine:
-    """Return a synchronous engine suitable for seeding."""
-    seed_url = os.getenv("SEED_DATABASE_URL", settings.database_url)
-    return create_engine(ensure_sync_dsn(seed_url))
-
-
-def _needs_seeding(session: Session) -> bool:
-    total = session.scalar(select(func.count()).select_from(Product))
-    return not total
+
+LOG = logging.getLogger("brace_backend.db.seed")
+
+
+def _engine() -> Engine:
+    """Return a synchronous engine suitable for seeding."""
+    seed_url = os.getenv("SEED_DATABASE_URL", settings.database_url)
+    return create_engine(ensure_sync_dsn(seed_url))
+
+
+def _needs_seeding(session: Session) -> bool:
+    total = session.scalar(select(func.count()).select_from(Product))
+    return not total
+
+SEED_NAMESPACE = uuid.UUID("cb4290f9-9882-4a9d-9c82-2d19a7af8e0d")  # PRINCIPAL-FIX: deterministic ids
 
 
 def _seed_products(session: Session) -> None:
     catalog = [
-        ("Smoke Tee", "Classic tee for smoke tests", Decimal("39.99"), "M", 50),
-        ("Smoke Hoodie", "Cozy hoodie for testing", Decimal("59.99"), "L", 25),
-        ("Smoke Joggers", "Comfort joggers", Decimal("45.00"), "S", 10),
+        ("Smoke Tee", "Classic tee for smoke tests", "39.99", "M", 50),
+        ("Smoke Hoodie", "Cozy hoodie for testing", "59.99", "L", 25),
+        ("Smoke Joggers", "Comfort joggers", "45.00", "S", 10),
     ]
     for name, description, price, size, stock in catalog:
-        product = Product(name=name, description=description, hero_media_url=None)
-        variant = ProductVariant(size=size, price=price, stock=stock)
+        product_id = uuid.uuid5(SEED_NAMESPACE, name)
+        variant_id = uuid.uuid5(SEED_NAMESPACE, f"{name}:{size}")
+        product = Product(id=product_id, name=name, description=description, hero_media_url=None)
+        variant = ProductVariant(
+            id=variant_id,
+            product_id=product_id,
+            size=size,
+            price_minor_units=to_minor_units(price),
+            stock=stock,
+        )
         product.variants.append(variant)
         session.add(product)
     session.commit()
-    LOG.info("Seeded %s products for smoke tests.", len(catalog))
-
-
-def run_seed() -> None:
-    logging.basicConfig(level=logging.INFO)
-    engine = _engine()
-    with Session(engine) as session:
-        if _needs_seeding(session):
-            _seed_products(session)
-        else:
-            LOG.info("Products already present; skipping seed.")
-
-
-if __name__ == "__main__":
-    run_seed()
+    LOG.info("Seeded %s products for smoke tests.", len(catalog))  # PRINCIPAL-FIX: deterministic seed data
+
+
+def run_seed() -> None:
+    logging.basicConfig(level=logging.INFO)
+    engine = _engine()
+    with Session(engine) as session:
+        if _needs_seeding(session):
+            _seed_products(session)
+        else:
+            LOG.info("Products already present; skipping seed.")
+
+
+if __name__ == "__main__":
+    run_seed()

diff --git a/packages/backend/src/brace_backend/services/seed.py b/packages/backend/src/brace_backend/services/seed.py
index fb6d94c..1c47e12 100644
--- a/packages/backend/src/brace_backend/services/seed.py
+++ b/packages/backend/src/brace_backend/services/seed.py
@@ -1,10 +1,13 @@
-import asyncio
+import asyncio
 import uuid
 
 from brace_backend.db.session import session_manager
 from brace_backend.domain import Product, ProductVariant
+from brace_backend.core.money import to_minor_units
 from sqlalchemy import select
 
+SEED_NAMESPACE = uuid.UUID("ac4d53b1-d996-4d06-9c90-25f6a16aaf7f")  # PRINCIPAL-FIX: deterministic ids
+
 
 async def seed_products() -> None:
     async with session_manager.session() as session:
@@ -15,19 +18,25 @@ async def seed_products() -> None:
         products: list[Product] = []
         for idx in range(1, 7):
             product = Product(
-                id=uuid.uuid4(),
+                id=uuid.uuid5(SEED_NAMESPACE, f"brace-essential-{idx}"),
                 name=f"BRACE Essential {idx}",
                 description="Premium cotton boxer briefs with adaptive fit.",
                 hero_media_url=f"https://cdn.example.com/products/{idx}.jpg",
             )
             product.variants = [
-                ProductVariant(size=size, price=29.99 + idx, stock=100, product_id=product.id)
+                ProductVariant(
+                    id=uuid.uuid5(SEED_NAMESPACE, f"brace-essential-{idx}:{size}"),
+                    size=size,
+                    price_minor_units=to_minor_units(29.99 + idx),
+                    stock=100,
+                    product_id=product.id,
+                )
                 for size in ["S", "M", "L", "XL"]
             ]
-            products.append(product)
-        session.add_all(products)
-        await session.commit()
-
-
-if __name__ == "__main__":
-    asyncio.run(seed_products())
+            products.append(product)
+        session.add_all(products)
+        await session.commit()
+
+
+if __name__ == "__main__":
+    asyncio.run(seed_products())

diff --git a/packages/backend/src/brace_backend/schemas/cart.py b/packages/backend/src/brace_backend/schemas/cart.py
index d3e8a1d..599795a 100644
--- a/packages/backend/src/brace_backend/schemas/cart.py
+++ b/packages/backend/src/brace_backend/schemas/cart.py
@@ -1,26 +1,26 @@
-from uuid import UUID
-
-from pydantic import BaseModel, ConfigDict, Field
-
-
+from uuid import UUID
+
+from pydantic import BaseModel, ConfigDict, Field
+
+
 class CartItemCreate(BaseModel):
     product_id: UUID
-    size: str
+    size: str = Field(min_length=1, max_length=10)  # PRINCIPAL-FIX: align with product_variants.size
     quantity: int = Field(default=1, ge=1, le=10)
-
-
+
+
 class CartItemRead(BaseModel):
     model_config = ConfigDict(from_attributes=True)
 
     id: UUID
     product_id: UUID
     product_name: str
-    size: str
+    size: str = Field(min_length=1, max_length=25)
     quantity: int
-    unit_price: float
+    unit_price_minor_units: int
     hero_media_url: str | None = None
 
 
 class CartCollection(BaseModel):
     items: list[CartItemRead]
-    total_amount: float
+    total_minor_units: int

diff --git a/packages/backend/src/brace_backend/schemas/orders.py b/packages/backend/src/brace_backend/schemas/orders.py
index 9e22ab2..49f0679 100644
--- a/packages/backend/src/brace_backend/schemas/orders.py
+++ b/packages/backend/src/brace_backend/schemas/orders.py
@@ -1,7 +1,7 @@
-from datetime import datetime
-from uuid import UUID
-
-from pydantic import BaseModel, ConfigDict
+from datetime import datetime
+from uuid import UUID
+
+from pydantic import BaseModel, ConfigDict, Field
 
 
 class OrderItemRead(BaseModel):
@@ -11,7 +11,7 @@ class OrderItemRead(BaseModel):
     product_id: UUID
     size: str
     quantity: int
-    unit_price: str
+    unit_price_minor_units: int
 
 
 class OrderRead(BaseModel):
@@ -19,13 +19,13 @@ class OrderRead(BaseModel):
 
     id: UUID
     status: str
-    total_amount: str
+    total_minor_units: int
     shipping_address: str | None = None
     note: str | None = None
     created_at: datetime
     items: list[OrderItemRead]
-
-
+
+
 class OrderCreate(BaseModel):
-    shipping_address: str | None = None
+    shipping_address: str | None = Field(default=None, max_length=512)  # PRINCIPAL-FIX
     note: str | None = None

diff --git a/packages/backend/tests/fullstack_smoke.py b/packages/backend/tests/fullstack_smoke.py
index a9729a1..cbe60e4 100644
--- a/packages/backend/tests/fullstack_smoke.py
+++ b/packages/backend/tests/fullstack_smoke.py
@@ -1,251 +1,274 @@
-from __future__ import annotations
-
+from __future__ import annotations
+
 import asyncio
 import json
 import os
+import secrets
 import time
 from dataclasses import dataclass
-from decimal import Decimal
-from typing import Any
-from urllib.parse import quote
-from uuid import UUID
-
-import httpx
-from brace_backend.core.security import build_signature
-from brace_backend.domain.base import Base
-from brace_backend.domain.product import Product, ProductVariant
-from sqlalchemy import text
-from sqlalchemy.ext.asyncio import AsyncSession, async_sessionmaker, create_async_engine
-from sqlalchemy.pool import NullPool
-
-
-def _require_env(name: str) -> str:
-    value = os.getenv(name)
-    if not value:
+from typing import Any
+from urllib.parse import quote
+from uuid import UUID
+
+import httpx
+from brace_backend.core.security import build_signature
+from brace_backend.domain.base import Base
+from brace_backend.domain.product import Product, ProductVariant
+from sqlalchemy import text
+from sqlalchemy.ext.asyncio import AsyncSession, async_sessionmaker, create_async_engine
+from sqlalchemy.pool import NullPool
+
+
+def _require_env(name: str) -> str:
+    value = os.getenv(name)
+    if not value:
+        raise RuntimeError(
+            f"{name} is required for full-stack smoke tests. "
+            "Add it to .env, infra/docker-compose.prod.yml, or your deployment secrets."
+        )
+    return value
+
+
+def _require_smoke_database_url() -> str:
+    url = os.getenv(
+        "SMOKE_DATABASE_URL",
+        os.getenv(
+            "DATABASE_URL", "postgresql+asyncpg://postgres:postgres@localhost:5432/brace_smoke"
+        ),
+    )
+    if "brace_smoke" not in url.rsplit("/", 1)[-1]:
         raise RuntimeError(
-            f"{name} is required for full-stack smoke tests. "
-            "Add it to .env, infra/docker-compose.prod.yml, or your deployment secrets."
-        )
-    return value
-
-
-DATABASE_URL = os.getenv(
-    "SMOKE_DATABASE_URL",
-    os.getenv("DATABASE_URL", "postgresql+asyncpg://postgres:postgres@localhost:5432/brace"),
-)
-BACKEND_BASE_URL = os.getenv("SMOKE_BACKEND_URL", "http://localhost:8000")
-FRONTEND_BASE_URL = os.getenv("SMOKE_FRONTEND_URL", "http://localhost")
-TELEGRAM_BOT_TOKEN = _require_env("BRACE_TELEGRAM_BOT_TOKEN")
+            "SMOKE_DATABASE_URL must point to a dedicated brace_smoke database to avoid truncating production data."
+        )  # PRINCIPAL-FIX
+    return url
 
 
-@dataclass
+DATABASE_URL = _require_smoke_database_url()
+BACKEND_BASE_URL = os.getenv("SMOKE_BACKEND_URL", "http://localhost:8000")
+FRONTEND_BASE_URL = os.getenv("SMOKE_FRONTEND_URL", "http://localhost")
+TELEGRAM_BOT_TOKEN = _require_env("BRACE_TELEGRAM_BOT_TOKEN")
+
+
+@dataclass
 class SeededProduct:
-    id: UUID
-    variant_id: UUID
-    size: str
-    name: str
-    price: Decimal
-    stock: int
-
-
+    id: UUID
+    variant_id: UUID
+    size: str
+    name: str
+    price_minor_units: int
+    stock: int
+
+
 def build_telegram_init_header(user_payload: dict[str, Any]) -> str:
     auth_date = int(time.time())
-    payload = {"user": user_payload, "auth_date": auth_date}
+    payload = {"user": user_payload, "auth_date": auth_date, "nonce": secrets.token_hex(8)}
     signature = build_signature(payload.copy(), secret_token=TELEGRAM_BOT_TOKEN)
     encoded_user = quote(json.dumps(user_payload, separators=(",", ":"), ensure_ascii=False))
-    return f"auth_date={auth_date}&user={encoded_user}&hash={signature}"
-
-
-async def reset_database(engine) -> None:
-    async with engine.begin() as conn:
-        await conn.run_sync(Base.metadata.create_all)
-        tables = ", ".join(f'"{tbl.name}"' for tbl in Base.metadata.sorted_tables)
-        if tables:
-            await conn.execute(text(f"TRUNCATE {tables} RESTART IDENTITY CASCADE"))
-
-
-async def seed_products(engine) -> list[SeededProduct]:
-    session_factory = async_sessionmaker(bind=engine, expire_on_commit=False, class_=AsyncSession)
-    products: list[SeededProduct] = []
+    nonce = payload["nonce"]
+    return f"auth_date={auth_date}&nonce={nonce}&user={encoded_user}&hash={signature}"
+
+
+async def reset_database(engine) -> None:
+    async with engine.begin() as conn:
+        await conn.run_sync(Base.metadata.create_all)
+        tables = ", ".join(f'"{tbl.name}"' for tbl in Base.metadata.sorted_tables)
+        if tables:
+            await conn.execute(text(f"TRUNCATE {tables} RESTART IDENTITY CASCADE"))
+
+
+async def seed_products(engine) -> list[SeededProduct]:
+    session_factory = async_sessionmaker(bind=engine, expire_on_commit=False, class_=AsyncSession)
+    products: list[SeededProduct] = []
     catalog = [
-        ("Smoke Tee", Decimal("39.99"), "M", 50),
-        ("Smoke Hoodie", Decimal("59.99"), "L", 25),
-        ("Smoke Joggers", Decimal("45.00"), "S", 10),
+        ("Smoke Tee", 3999, "M", 50),
+        ("Smoke Hoodie", 5999, "L", 25),
+        ("Smoke Joggers", 4500, "S", 10),
     ]
-    async with session_factory() as session:
-        for name, price, size, stock in catalog:
+    async with session_factory() as session:
+        for name, price_minor_units, size, stock in catalog:
             product = Product(name=name, description=f"{name} description", hero_media_url=None)
-            variant = ProductVariant(product=product, size=size, price=price, stock=stock)
+            variant = ProductVariant(
+                product=product, size=size, price_minor_units=price_minor_units, stock=stock
+            )
             product.variants.append(variant)
             session.add(product)
             await session.flush()
-            products.append(SeededProduct(id=product.id, variant_id=variant.id, size=size, name=name, price=price, stock=stock))
-        await session.commit()
-    return products
-
-
-async def wait_for_backend(client: httpx.AsyncClient, timeout: float = 30.0) -> None:
-    started = time.time()
-    while True:
-        try:
-            response = await client.get("/api/health", timeout=5.0)
-            if response.status_code == 200:
-                return
-        except httpx.HTTPError:
-            pass
-        if time.time() - started > timeout:
-            raise TimeoutError("Backend health endpoint did not become ready in time.")
-        await asyncio.sleep(1)
-
-
-def assert_envelope(response: httpx.Response, *, status: int = 200) -> dict[str, Any]:
-    if response.status_code != status:
-        raise AssertionError(f"Expected status {status}, got {response.status_code}: {response.text}")
-    payload = response.json()
-    assert "data" in payload, "Envelope missing data field"
-    assert "error" in payload, "Envelope missing error field"
-    pagination = payload.get("pagination")
-    if pagination is not None:
-        for field in ("page", "page_size", "pages", "total"):
-            assert field in pagination, f"Pagination missing {field}"
-    return payload
-
-
-async def clear_cart(client: httpx.AsyncClient, headers: dict[str, str]) -> None:
-    snapshot = assert_envelope(await client.get("/api/cart", headers=headers))
-    for item in snapshot["data"].get("items", []):
-        await client.delete(f"/api/cart/{item['id']}", headers=headers)
-
-
-async def scenario_products(client: httpx.AsyncClient, products: list[SeededProduct]) -> None:
-    listing = assert_envelope(await client.get("/api/products"))
-    assert listing["pagination"]["total"] == len(products)
-    paged = assert_envelope(await client.get("/api/products", params={"page": 2, "page_size": 2}))
-    assert paged["pagination"]["page"] == 2
-    assert paged["pagination"]["pages"] == 2
-    detail = assert_envelope(await client.get(f"/api/products/{products[0].id}"))
-    assert detail["data"]["id"] == str(
-        products[0].id
-    ), f"Product detail mismatch: {detail['data']['id']} != {products[0].id}"
-
-
-async def scenario_cart_and_orders(client: httpx.AsyncClient, products: list[SeededProduct], engine) -> None:
-    user_payload = {"id": 987654, "first_name": "Smoke", "username": "smoke_user"}
-    headers = {"X-Telegram-Init-Data": build_telegram_init_header(user_payload)}
-    primary = products[0]
-    # Cart add/remove
-    created = assert_envelope(
-        await client.post(
-            "/api/cart",
-            json={"product_id": str(primary.id), "size": primary.size, "quantity": 2},
-            headers=headers,
-        ),
-        status=201,
-    )
-    cart = assert_envelope(await client.get("/api/cart", headers=headers))
-    assert cart["data"]["total_amount"] >= float(primary.price)
-    assert_envelope(await client.delete(f"/api/cart/{created['data']['id']}", headers=headers))
-    empty = assert_envelope(await client.get("/api/cart", headers=headers))
-    assert empty["data"]["total_amount"] == 0
-    # Quantity limit
-    assert_envelope(
-        await client.post(
-            "/api/cart",
-            json={"product_id": str(primary.id), "size": primary.size, "quantity": 10},
-            headers=headers,
-        ),
-        status=201,
-    )
-    limit_resp = await client.post(
-        "/api/cart",
-        json={"product_id": str(primary.id), "size": primary.size, "quantity": 1},
-        headers=headers,
-    )
-    assert limit_resp.status_code == 422
-    # Order creation
-    await clear_cart(client, headers)
-    assert_envelope(
-        await client.post(
-            "/api/cart",
-            json={"product_id": str(primary.id), "size": primary.size, "quantity": 2},
-            headers=headers,
-        ),
-        status=201,
-    )
-    order = assert_envelope(await client.post("/api/orders", json={}, headers=headers), status=201)
-    assert len(order["data"]["items"]) == 1
-    first_page = assert_envelope(
-        await client.get("/api/orders", headers=headers, params={"page": 1, "page_size": 5})
-    )
-    assert first_page["pagination"]["total"] >= 1
-    post_order_cart = assert_envelope(await client.get("/api/cart", headers=headers))
-    assert post_order_cart["data"]["items"] == []
-    # Empty cart error
-    empty_order = await client.post("/api/orders", json={}, headers=headers)
-    assert empty_order.status_code == 422
-    # Overstock scenario
-    overstock = products[1]
-    assert_envelope(
-        await client.post(
-            "/api/cart",
-            json={"product_id": str(overstock.id), "size": overstock.size, "quantity": 4},
-            headers=headers,
-        ),
-        status=201,
-    )
-    session_factory = async_sessionmaker(bind=engine, expire_on_commit=False, class_=AsyncSession)
-    async with session_factory() as session:
-        variant = await session.get(ProductVariant, overstock.variant_id)
-        if variant:
-            variant.stock = 2
-            await session.commit()
-    overstock_resp = await client.post("/api/orders", json={}, headers=headers)
-    assert overstock_resp.status_code == 422
-    await clear_cart(client, headers)
-    # User endpoint
-    me = assert_envelope(await client.get("/api/users/me", headers=headers))
-    assert me["data"]["telegram_id"] == user_payload["id"]
-
-
-async def scenario_frontend_health() -> None:
-    async with httpx.AsyncClient(base_url=FRONTEND_BASE_URL, timeout=10.0) as client:
-        resp = await client.get("/")
-        if resp.status_code != 200:
-            raise AssertionError(f"Frontend unreachable: {resp.status_code}")
-        assert "html" in resp.headers.get("content-type", ""), "Frontend did not return HTML"
-
-
-async def run_smoke() -> None:
-    engine = create_async_engine(DATABASE_URL, future=True, poolclass=NullPool)
-    await reset_database(engine)
-    products = await seed_products(engine)
-    results: list[tuple[str, bool, str | None]] = []
-    async with httpx.AsyncClient(base_url=BACKEND_BASE_URL, timeout=20.0) as client:
-        await wait_for_backend(client)
-        for name, coroutine in [
-            ("Products endpoints", scenario_products(client, products)),
-            ("Cart & orders endpoints", scenario_cart_and_orders(client, products, engine)),
-        ]:
-            try:
-                await coroutine
-                results.append((name, True, None))
-            except Exception as exc:
-                results.append((name, False, str(exc)))
-    for name, coroutine in [("Frontend availability", scenario_frontend_health())]:
-        try:
-            await coroutine
-            results.append((name, True, None))
-        except Exception as exc:
-            results.append((name, False, str(exc)))
-    print("\nFull-stack smoke test summary:\n")
-    for name, ok, msg in results:
-        status = "✅ PASS" if ok else "❌ FAIL"
-        detail = "" if not msg else f" - {msg}"
-        print(f"{status} {name}{detail}")
-    failures = [r for r in results if not r[1]]
-    if failures:
-        raise SystemExit(1)
-
-
-if __name__ == "__main__":
-    asyncio.run(run_smoke())
+            products.append(
+                SeededProduct(
+                    id=product.id,
+                    variant_id=variant.id,
+                    size=size,
+                    name=name,
+                    price_minor_units=price_minor_units,
+                    stock=stock,
+                )
+            )
+        await session.commit()
+    return products
+
+
+async def wait_for_backend(client: httpx.AsyncClient, timeout: float = 30.0) -> None:
+    started = time.time()
+    while True:
+        try:
+            response = await client.get("/api/health", timeout=5.0)
+            if response.status_code == 200:
+                return
+        except httpx.HTTPError:
+            pass
+        if time.time() - started > timeout:
+            raise TimeoutError("Backend health endpoint did not become ready in time.")
+        await asyncio.sleep(1)
+
+
+def assert_envelope(response: httpx.Response, *, status: int = 200) -> dict[str, Any]:
+    if response.status_code != status:
+        raise AssertionError(f"Expected status {status}, got {response.status_code}: {response.text}")
+    payload = response.json()
+    assert "data" in payload, "Envelope missing data field"
+    assert "error" in payload, "Envelope missing error field"
+    pagination = payload.get("pagination")
+    if pagination is not None:
+        for field in ("page", "page_size", "pages", "total"):
+            assert field in pagination, f"Pagination missing {field}"
+    return payload
+
+
+async def clear_cart(client: httpx.AsyncClient, headers: dict[str, str]) -> None:
+    snapshot = assert_envelope(await client.get("/api/cart", headers=headers))
+    for item in snapshot["data"].get("items", []):
+        await client.delete(f"/api/cart/{item['id']}", headers=headers)
+
+
+async def scenario_products(client: httpx.AsyncClient, products: list[SeededProduct]) -> None:
+    listing = assert_envelope(await client.get("/api/products"))
+    assert listing["pagination"]["total"] == len(products)
+    paged = assert_envelope(await client.get("/api/products", params={"page": 2, "page_size": 2}))
+    assert paged["pagination"]["page"] == 2
+    assert paged["pagination"]["pages"] == 2
+    detail = assert_envelope(await client.get(f"/api/products/{products[0].id}"))
+    assert detail["data"]["id"] == str(
+        products[0].id
+    ), f"Product detail mismatch: {detail['data']['id']} != {products[0].id}"
+
+
+async def scenario_cart_and_orders(client: httpx.AsyncClient, products: list[SeededProduct], engine) -> None:
+    user_payload = {"id": 987654, "first_name": "Smoke", "username": "smoke_user"}
+    headers = {"X-Telegram-Init-Data": build_telegram_init_header(user_payload)}
+    primary = products[0]
+    # Cart add/remove
+    created = assert_envelope(
+        await client.post(
+            "/api/cart",
+            json={"product_id": str(primary.id), "size": primary.size, "quantity": 2},
+            headers=headers,
+        ),
+        status=201,
+    )
+    cart = assert_envelope(await client.get("/api/cart", headers=headers))
+    assert cart["data"]["total_minor_units"] >= primary.price_minor_units
+    assert_envelope(await client.delete(f"/api/cart/{created['data']['id']}", headers=headers))
+    empty = assert_envelope(await client.get("/api/cart", headers=headers))
+    assert empty["data"]["total_minor_units"] == 0
+    # Quantity limit
+    assert_envelope(
+        await client.post(
+            "/api/cart",
+            json={"product_id": str(primary.id), "size": primary.size, "quantity": 10},
+            headers=headers,
+        ),
+        status=201,
+    )
+    limit_resp = await client.post(
+        "/api/cart",
+        json={"product_id": str(primary.id), "size": primary.size, "quantity": 1},
+        headers=headers,
+    )
+    assert limit_resp.status_code == 422
+    # Order creation
+    await clear_cart(client, headers)
+    assert_envelope(
+        await client.post(
+            "/api/cart",
+            json={"product_id": str(primary.id), "size": primary.size, "quantity": 2},
+            headers=headers,
+        ),
+        status=201,
+    )
+    order = assert_envelope(await client.post("/api/orders", json={}, headers=headers), status=201)
+    assert len(order["data"]["items"]) == 1
+    first_page = assert_envelope(
+        await client.get("/api/orders", headers=headers, params={"page": 1, "page_size": 5})
+    )
+    assert first_page["pagination"]["total"] >= 1
+    post_order_cart = assert_envelope(await client.get("/api/cart", headers=headers))
+    assert post_order_cart["data"]["items"] == []
+    # Empty cart error
+    empty_order = await client.post("/api/orders", json={}, headers=headers)
+    assert empty_order.status_code == 422
+    # Overstock scenario
+    overstock = products[1]
+    assert_envelope(
+        await client.post(
+            "/api/cart",
+            json={"product_id": str(overstock.id), "size": overstock.size, "quantity": 4},
+            headers=headers,
+        ),
+        status=201,
+    )
+    session_factory = async_sessionmaker(bind=engine, expire_on_commit=False, class_=AsyncSession)
+    async with session_factory() as session:
+        variant = await session.get(ProductVariant, overstock.variant_id)
+        if variant:
+            variant.stock = 2
+            await session.commit()
+    overstock_resp = await client.post("/api/orders", json={}, headers=headers)
+    assert overstock_resp.status_code == 422
+    await clear_cart(client, headers)
+    # User endpoint
+    me = assert_envelope(await client.get("/api/users/me", headers=headers))
+    assert me["data"]["telegram_id"] == user_payload["id"]
+
+
+async def scenario_frontend_health() -> None:
+    async with httpx.AsyncClient(base_url=FRONTEND_BASE_URL, timeout=10.0) as client:
+        resp = await client.get("/")
+        if resp.status_code != 200:
+            raise AssertionError(f"Frontend unreachable: {resp.status_code}")
+        assert "html" in resp.headers.get("content-type", ""), "Frontend did not return HTML"
+
+
+async def run_smoke() -> None:
+    engine = create_async_engine(DATABASE_URL, future=True, poolclass=NullPool)
+    await reset_database(engine)
+    products = await seed_products(engine)
+    results: list[tuple[str, bool, str | None]] = []
+    async with httpx.AsyncClient(base_url=BACKEND_BASE_URL, timeout=20.0) as client:
+        await wait_for_backend(client)
+        for name, coroutine in [
+            ("Products endpoints", scenario_products(client, products)),
+            ("Cart & orders endpoints", scenario_cart_and_orders(client, products, engine)),
+        ]:
+            try:
+                await coroutine
+                results.append((name, True, None))
+            except Exception as exc:
+                results.append((name, False, str(exc)))
+    for name, coroutine in [("Frontend availability", scenario_frontend_health())]:
+        try:
+            await coroutine
+            results.append((name, True, None))
+        except Exception as exc:
+            results.append((name, False, str(exc)))
+    print("\nFull-stack smoke test summary:\n")
+    for name, ok, msg in results:
+        status = "✅ PASS" if ok else "❌ FAIL"
+        detail = "" if not msg else f" - {msg}"
+        print(f"{status} {name}{detail}")
+    failures = [r for r in results if not r[1]]
+    if failures:
+        raise SystemExit(1)
+
+
+if __name__ == "__main__":
+    asyncio.run(run_smoke())

diff --git a/packages/backend/tests/test_api_endpoints.py b/packages/backend/tests/test_api_endpoints.py
index 399b252..97da99c 100644
--- a/packages/backend/tests/test_api_endpoints.py
+++ b/packages/backend/tests/test_api_endpoints.py
@@ -1,106 +1,106 @@
-from __future__ import annotations
-
-import pytest
-from brace_backend.api.deps import get_current_init_data, get_current_user
-from brace_backend.domain.product import ProductVariant
-from brace_backend.main import app
-from sqlalchemy import select
-
-pytestmark = pytest.mark.asyncio
-
-
-def assert_envelope(response, *, status=200):
-    """All API responses are wrapped into the same envelope."""
-    assert response.status_code == status
-    payload = response.json()
-    assert "data" in payload
-    assert "error" in payload
-    return payload
-
-
-async def _create_sample_products(ctx, count: int) -> None:
-    """Bulk helper to seed a deterministic number of catalog items."""
-    for idx in range(count):
-        await ctx["create_product"](name=f"Product {idx}", price=30 + idx)
-
-
-async def test_products_list_default(api_client):
-    """Default pagination should return the first page with all metadata filled."""
-    client, ctx = api_client
-    await _create_sample_products(ctx, 2)
-
-    payload = assert_envelope(await client.get("/api/products"))
-    assert len(payload["data"]) == 2
-    pagination = payload["pagination"]
-    assert pagination["page"] == 1
-    assert pagination["total"] == 2
-    assert pagination["pages"] == 1
-
-
-async def test_products_list_paginated(api_client):
-    """Explicit page/page_size queries must reflect the correct counts."""
-    client, ctx = api_client
-    await _create_sample_products(ctx, 3)
-
-    payload = assert_envelope(
-        await client.get("/api/products", params={"page": 2, "page_size": 2})
-    )
-    assert len(payload["data"]) == 1
-    pagination = payload["pagination"]
-    assert pagination["page"] == 2
-    assert pagination["page_size"] == 2
-    assert pagination["total"] == 3
-    assert pagination["pages"] == 2
-
-
-async def test_products_detail(api_client):
-    """Individual product endpoint should return the requested record."""
-    client, ctx = api_client
-    product, _ = await ctx["create_product"](name="Detailed Product")
-
-    payload = assert_envelope(await client.get(f"/api/products/{product.id}"))
-    assert payload["data"]["id"] == str(product.id)
-    assert payload["data"]["name"] == "Detailed Product"
-
-
-async def test_cart_add_remove(api_client):
-    """Cart items should accumulate totals and drop back to zero after deletion."""
-    client, ctx = api_client
-    product, variant = await ctx["create_product"](price=31.0)
-
-    payload = assert_envelope(
-        await client.post(
-            "/api/cart",
-            json={"product_id": str(product.id), "size": variant.size, "quantity": 2},
-        ),
-        status=201,
-    )
-    item_id = payload["data"]["id"]
-    assert payload["data"]["quantity"] == 2
-
-    cart_payload = assert_envelope(await client.get("/api/cart"))
-    assert cart_payload["data"]["total_amount"] == pytest.approx(62.0)
-    assert len(cart_payload["data"]["items"]) == 1
-
-    assert_envelope(await client.delete(f"/api/cart/{item_id}"))
-    final_payload = assert_envelope(await client.get("/api/cart"))
-    assert final_payload["data"]["total_amount"] == 0
-    assert final_payload["data"]["items"] == []
-
-
+from __future__ import annotations
+
+import pytest
+from brace_backend.api.deps import get_current_init_data, get_current_user
+from brace_backend.domain.product import ProductVariant
+from brace_backend.main import app
+from sqlalchemy import select
+
+pytestmark = pytest.mark.asyncio
+
+
+def assert_envelope(response, *, status=200):
+    """All API responses are wrapped into the same envelope."""
+    assert response.status_code == status
+    payload = response.json()
+    assert "data" in payload
+    assert "error" in payload
+    return payload
+
+
+async def _create_sample_products(ctx, count: int) -> None:
+    """Bulk helper to seed a deterministic number of catalog items."""
+    for idx in range(count):
+        await ctx["create_product"](name=f"Product {idx}", price_minor_units=(30 + idx) * 100)
+
+
+async def test_products_list_default(api_client):
+    """Default pagination should return the first page with all metadata filled."""
+    client, ctx = api_client
+    await _create_sample_products(ctx, 2)
+
+    payload = assert_envelope(await client.get("/api/products"))
+    assert len(payload["data"]) == 2
+    pagination = payload["pagination"]
+    assert pagination["page"] == 1
+    assert pagination["total"] == 2
+    assert pagination["pages"] == 1
+
+
+async def test_products_list_paginated(api_client):
+    """Explicit page/page_size queries must reflect the correct counts."""
+    client, ctx = api_client
+    await _create_sample_products(ctx, 3)
+
+    payload = assert_envelope(
+        await client.get("/api/products", params={"page": 2, "page_size": 2})
+    )
+    assert len(payload["data"]) == 1
+    pagination = payload["pagination"]
+    assert pagination["page"] == 2
+    assert pagination["page_size"] == 2
+    assert pagination["total"] == 3
+    assert pagination["pages"] == 2
+
+
+async def test_products_detail(api_client):
+    """Individual product endpoint should return the requested record."""
+    client, ctx = api_client
+    product, _ = await ctx["create_product"](name="Detailed Product")
+
+    payload = assert_envelope(await client.get(f"/api/products/{product.id}"))
+    assert payload["data"]["id"] == str(product.id)
+    assert payload["data"]["name"] == "Detailed Product"
+
+
+async def test_cart_add_remove(api_client):
+    """Cart items should accumulate totals and drop back to zero after deletion."""
+    client, ctx = api_client
+    product, variant = await ctx["create_product"](price_minor_units=3100)
+
+    payload = assert_envelope(
+        await client.post(
+            "/api/cart",
+            json={"product_id": str(product.id), "size": variant.size, "quantity": 2},
+        ),
+        status=201,
+    )
+    item_id = payload["data"]["id"]
+    assert payload["data"]["quantity"] == 2
+
+    cart_payload = assert_envelope(await client.get("/api/cart"))
+    assert cart_payload["data"]["total_minor_units"] == 6200
+    assert len(cart_payload["data"]["items"]) == 1
+
+    assert_envelope(await client.delete(f"/api/cart/{item_id}"))
+    final_payload = assert_envelope(await client.get("/api/cart"))
+    assert final_payload["data"]["total_minor_units"] == 0
+    assert final_payload["data"]["items"] == []
+
+
 async def test_cart_quantity_limit(api_client):
     """The service must reject quantities that exceed the configured per-item limit."""
     client, ctx = api_client
     product, variant = await ctx["create_product"](stock=20)
-
-    assert_envelope(
-        await client.post(
-            "/api/cart",
-            json={"product_id": str(product.id), "size": variant.size, "quantity": 10},
-        ),
-        status=201,
-    )
-
+
+    assert_envelope(
+        await client.post(
+            "/api/cart",
+            json={"product_id": str(product.id), "size": variant.size, "quantity": 10},
+        ),
+        status=201,
+    )
+
     response = await client.post(
         "/api/cart",
         json={"product_id": str(product.id), "size": variant.size, "quantity": 1},
@@ -109,61 +109,92 @@ async def test_cart_quantity_limit(api_client):
     assert payload["error"]["type"] == "validation_error"
 
 
-async def test_orders_create_and_list(api_client):
-    """Creating an order should consume the cart and affect pagination totals."""
+async def test_cart_rejects_invalid_size_length(api_client):
+    """Cart payload validation must guard against oversize size codes before hitting the DB."""
     client, ctx = api_client
-    product, variant = await ctx["create_product"](price=45.0)
+    product, _ = await ctx["create_product"]()
 
-    await client.post(
+    response = await client.post(
         "/api/cart",
-        json={"product_id": str(product.id), "size": variant.size, "quantity": 2},
+        json={"product_id": str(product.id), "size": "X" * 32, "quantity": 1},
     )
-    created = assert_envelope(await client.post("/api/orders", json={}), status=201)
-    assert created["data"]["total_amount"] == "90.00"
-
-    listed = assert_envelope(await client.get("/api/orders", params={"page": 1, "page_size": 5}))
-    assert len(listed["data"]) == 1
-    assert listed["pagination"]["total"] == 1
-    assert listed["pagination"]["pages"] == 1
-
-    empty_cart = assert_envelope(await client.get("/api/cart"))
-    assert empty_cart["data"]["total_amount"] == 0
-
-
-async def test_orders_empty_cart_error(api_client):
-    """Orders endpoint should guard against attempts without items."""
-    client, _ = api_client
-    response = await client.post("/api/orders", json={})
     payload = assert_envelope(response, status=422)
     assert payload["error"]["type"] == "validation_error"
 
 
+async def test_orders_create_and_list(api_client):
+    """Creating an order should consume the cart and affect pagination totals."""
+    client, ctx = api_client
+    product, variant = await ctx["create_product"](price_minor_units=4500)
+
+    await client.post(
+        "/api/cart",
+        json={"product_id": str(product.id), "size": variant.size, "quantity": 2},
+    )
+    created = assert_envelope(await client.post("/api/orders", json={}), status=201)
+    assert created["data"]["total_minor_units"] == 9000
+
+    listed = assert_envelope(await client.get("/api/orders", params={"page": 1, "page_size": 5}))
+    assert len(listed["data"]) == 1
+    assert listed["pagination"]["total"] == 1
+    assert listed["pagination"]["pages"] == 1
+
+    empty_cart = assert_envelope(await client.get("/api/cart"))
+    assert empty_cart["data"]["total_minor_units"] == 0
+
+
+async def test_orders_empty_cart_error(api_client):
+    """Orders endpoint should guard against attempts without items."""
+    client, _ = api_client
+    response = await client.post("/api/orders", json={})
+    payload = assert_envelope(response, status=422)
+    assert payload["error"]["type"] == "validation_error"
+
+
 async def test_orders_overstock_error(api_client):
     """Stock changes between cart and checkout must raise a validation error."""
     client, ctx = api_client
     product, variant = await ctx["create_product"](stock=5)
+
+    await client.post(
+        "/api/cart",
+        json={"product_id": str(product.id), "size": variant.size, "quantity": 3},
+    )
+    async with ctx["session_factory"]() as session:
+        db_variant = await session.scalar(select(ProductVariant).where(ProductVariant.id == variant.id))
+        db_variant.stock = 1
+        await session.commit()
+
+    response = await client.post("/api/orders", json={})
+    payload = assert_envelope(response, status=422)
+    assert payload["error"]["type"] == "validation_error"
+
+
+async def test_orders_reject_long_shipping_address(api_client):
+    """Order creation enforces DB column limits via schema validation."""
+    client, ctx = api_client
+    product, variant = await ctx["create_product"]()
 
     await client.post(
         "/api/cart",
-        json={"product_id": str(product.id), "size": variant.size, "quantity": 3},
+        json={"product_id": str(product.id), "size": variant.size, "quantity": 1},
     )
-    async with ctx["session_factory"]() as session:
-        db_variant = await session.scalar(select(ProductVariant).where(ProductVariant.id == variant.id))
-        db_variant.stock = 1
-        await session.commit()
 
-    response = await client.post("/api/orders", json={})
+    response = await client.post(
+        "/api/orders",
+        json={"shipping_address": "A" * 600},
+    )
     payload = assert_envelope(response, status=422)
     assert payload["error"]["type"] == "validation_error"
 
 
 async def test_users_me_requires_auth(api_client):
-    """Dropping auth dependencies should trigger the access denied handler."""
-    client, ctx = api_client
-    app.dependency_overrides.pop(get_current_user, None)
-    app.dependency_overrides.pop(get_current_init_data, None)
-
-    payload = assert_envelope(await client.get("/api/users/me"), status=403)
-    assert payload["error"]["type"] == "access_denied"
-
-    app.dependency_overrides.update(ctx["overrides"])
+    """Dropping auth dependencies should trigger the access denied handler."""
+    client, ctx = api_client
+    app.dependency_overrides.pop(get_current_user, None)
+    app.dependency_overrides.pop(get_current_init_data, None)
+
+    payload = assert_envelope(await client.get("/api/users/me"), status=403)
+    assert payload["error"]["type"] == "access_denied"
+
+    app.dependency_overrides.update(ctx["overrides"])

